<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title></title>
  <style>
    body {
      margin: 0;
    }
  </style>
</head>
<body>
  <script src="opal.min.js"></script>
  <script>
    (function() {
      var input = null;
      var output = '';
      var error = '';

      Opal.global.console.log = function(s) {
        output += s;
      };

      Opal.global.console.warn = function(s) {
        error += s;
      };

      Opal.STDIN.$read = function() {
        if (arguments.length !== 0) {
          throw 'read: not implemented';
        }
        return (input !== null ? input : Opal.nil);
      };

      window.addEventListener('message', function(event) {
        if (event.origin !== location.origin) {
          return;
        }

        var data = event.data;

        input = data.input;
        output = '';
        error = '';

        var exception = '';

        try {
          Opal.eval(data.code);
        } catch (e) {
          output = '';
          error = '';
          exception = e.toString() || 'undefined exception';
        }

        window.parent.postMessage({
          output: output,
          error: error,
          exception: exception,
        }, location.origin);
      });
    })();
  </script>
</body>
</html>
