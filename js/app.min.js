!function t(e,n,o){function i(s,h){if(!n[s]){if(!e[s]){var a="function"==typeof require&&require;if(!h&&a)return a(s,!0);if(r)return r(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var l=n[s]={exports:{}};e[s][0].call(l.exports,function(t){var n=e[s][1][t];return i(n||t)},l,l.exports,t,e,n,o)}return n[s].exports}for(var r="function"==typeof require&&require,s=0;s<o.length;s++)i(o[s]);return i}({1:[function(t,e,n){!function(e){"use strict";var n=e.dom||t("./dom.js"),o=e.Body||t("./components/body.js"),i=e.CircuitModule||t("./models/circuit-module.js");n.export("modular",i.modular),e.body=new o(n.body())}(this.app||(this.app={}))},{"./components/body.js":2,"./dom.js":17,"./models/circuit-module.js":19}],2:[function(t,e,n){!function(n){"use strict";var o=t("jcore"),i=n.dom||t("../dom.js"),r=n.Main||t("./main.js"),s=n.Sidebar||t("./sidebar.js"),h=o.Component.inherits(function(){this.hoverDisabled=this.prop(!1),this.dragCount=this.prop(0),this.sidebar=new s(i.find(this.el,".sidebar")),this.main=new r(i.find(this.el,".main"))});h.prototype.isDragging=function(){return this.dragCount()>0},h.prototype.incrementDragCount=function(){this.dragCount(this.dragCount()+1)},h.prototype.decrementDragCount=function(){this.dragCount(this.dragCount()-1)},h.prototype.disabled=function(t){this.sidebar.disabled(t),this.main.disabled(t)},h.prototype.dropModule=function(t,e,n){var o=e-this.main.contentOffsetLeft(),i=n-this.main.contentOffsetTop();o>=0&&i>=0&&this.loadModule(this.sidebar.entry(t),o,i)},h.prototype.toggleSidebar=function(){this.sidebar.disabled(!this.sidebar.disabled())},h.prototype.demoUrl=function(t){return"demos/"+t+".json"},h.prototype.load=function(){return this.sidebar.loadEntries().then(function(){return this.loadDemo()}.bind(this))},h.prototype.loadDemo=function(){var t=i.urlQuery(i.location(),"demo");return t?this.main.loadUrl(this.demoUrl(t)):Promise.resolve()},h.prototype.loadModule=function(t,e,n){this.main.loadModule({title:t.label,name:t.name,x:e,y:n},t.visiblePortNames)},h.prototype.oninit=function(){this.hoverDisabled(i.supportsTouch()),i.ready(this.onready.bind(this)),this.sidebar.on("dragstart",this.ondragstart.bind(this)),this.sidebar.on("dragend",this.ondragend.bind(this)),this.sidebar.on("drop",this.ondrop.bind(this)),this.main.on("sidebartoggle",this.onsidebartoggle.bind(this)),this.main.on("dragstart",this.ondragstart.bind(this)),this.main.on("dragend",this.ondragend.bind(this)),this.main.on("loadstart",this.onloadstart.bind(this)),this.main.on("loadend",this.onloadend.bind(this))},h.prototype.onredraw=function(){this.redrawBy("hoverDisabled",function(t){i.toggleClass(this.el,"hover-disabled",t)}),this.redrawBy("isDragging",function(t){i.toggleClass(this.el,"dragging",t)})},h.prototype.onready=function(){this.disabled(!0),this.load().catch(function(t){alert(t)}).then(function(){this.disabled(!1)}.bind(this))},h.prototype.ondragstart=function(){this.incrementDragCount()},h.prototype.ondragend=function(){this.decrementDragCount()},h.prototype.ondrop=function(t,e,n){this.dropModule(t,e,n)},h.prototype.onsidebartoggle=function(){this.toggleSidebar()},h.prototype.onloadstart=function(){this.disabled(!0)},h.prototype.onloadend=function(){this.disabled(!1)},void 0!==e&&e.exports?e.exports=h:n.Body=h}(this.app||(this.app={}))},{"../dom.js":17,"./main.js":7,"./sidebar.js":13,jcore:void 0}],3:[function(t,e,n){!function(n){"use strict";var o=t("jcore"),i=n.dom||t("../dom.js"),r=o.Component.inherits(function(){this.isActive=this.prop(!1),this.disabled=this.prop(!1),this.draggable=new r.Draggable(this)});r.prototype.oninit=function(){this.draggable.enable()},r.prototype.onredraw=function(){this.redrawBy("isActive",function(t){i.toggleClass(this.el,"active",t)}),this.redrawBy("disabled",function(t){i.toggleClass(this.el,"disabled",t)})},r.Draggable=function(){var t=o.Draggable.inherits();return t.prototype.onstart=function(t,e,n,o,r){r.target=i.target(o),i.cancel(o),i.removeFocus(),t.isActive(!0)},t.prototype.onmove=function(t,e,n,o,r){t.isActive(i.target(o)===r.target)},t.prototype.onend=function(t,e,n,o,r){t.isActive(!1),i.target(o)===r.target&&t.emit("tap")},t}(),void 0!==e&&e.exports?e.exports=r:n.Button=r}(this.app||(this.app={}))},{"../dom.js":17,jcore:void 0}],4:[function(t,e,n){!function(n){"use strict";var o=t("jcore"),i=n.dom||t("../dom.js"),r=n.Button||t("./button.js"),s=o.Component.inherits(function(){this.button=new r(this.el),this.input=new s.Input(i.find(this.el,".button-input"))});s.prototype.oninit=function(){this.button.on("tap",this.ontap.bind(this)),this.input.on("load",this.emit.bind(this,"load"))},s.prototype.ontap=function(){this.input.click()},s.Input=function(){var t=o.Component.inherits();return t.prototype.click=function(){i.click(this.el)},t.prototype.reset=function(){i.value(this.el,"")},t.prototype.oninit=function(){i.on(this.el,"change",this.onchange.bind(this))},t.prototype.onchange=function(t){var e=i.file(i.target(t));e&&(this.emit("load",e),this.reset())},t}(),void 0!==e&&e.exports?e.exports=s:n.LoadButton=s}(this.app||(this.app={}))},{"../dom.js":17,"./button.js":3,jcore:void 0}],5:[function(t,e,n){!function(n){"use strict";var o=t("jcore"),i=n.helper||t("../helper.js"),r=n.dom||t("../dom.js"),s=n.CircuitModule||t("../models/circuit-module.js"),h=n.LockRelation||t("../relations/lock-relation.js"),a=n.Module||t("./module.js"),u=n.ModulePort||t("./module-port.js"),l=n.Wire||t("./wire.js"),d=n.WireHandle||t("./wire-handle.js"),p=o.Component.inherits(function(){this.moduleContainer=new p.ModuleContainer(r.find(this.el,".module-container")),this.wireContainer=new p.WireContainer(r.find(this.el,".wire-container")),this.wireHandleContainer=new p.WireHandleContainer(r.find(this.el,".wire-handle-container"))});p.prototype.offsetLeft=function(){return r.offsetLeft(this.el)},p.prototype.offsetTop=function(){return r.offsetTop(this.el)},p.prototype.toData=function(){return this.moduleContainer.toData()},p.prototype.load=function(t){return this.moduleContainer.load(t)},p.prototype.loadModule=function(t,e){return this.moduleContainer.loadModule(t,e,null)},p.prototype.clear=function(){this.moduleContainer.clear()},p.prototype.portEventHighlighted=function(t,e){t.plugHighlighted(e),this.moduleContainer.portEventHighlighted(t,e),this.wireContainer.portEventHighlighted(t,e),this.wireHandleContainer.portEventHighlighted(t,e)},p.prototype.oninit=function(){r.on(this.el,r.eventType("start"),this.onpoint.bind(this)),this.moduleContainer.on("connect",this.wireContainer.onconnect.bind(this.wireContainer)),this.moduleContainer.on("disconnect",this.wireContainer.ondisconnect.bind(this.wireContainer)),this.moduleContainer.on("portevent",this.onportevent.bind(this)),this.moduleContainer.on("dragstart",this.emit.bind(this,"dragstart")),this.moduleContainer.on("dragend",this.emit.bind(this,"dragend")),this.moduleContainer.on("handlestart",this.wireContainer.onhandlestart.bind(this.wireContainer)),this.moduleContainer.on("handlemove",this.wireContainer.onhandlemove.bind(this.wireContainer)),this.moduleContainer.on("handleend",this.wireContainer.onhandleend.bind(this.wireContainer)),this.moduleContainer.on("handleattach",this.wireContainer.onhandleattach.bind(this.wireContainer)),this.moduleContainer.on("handledetach",this.wireContainer.onhandledetach.bind(this.wireContainer)),this.moduleContainer.on("handlestart",this.wireHandleContainer.onhandlestart.bind(this.wireHandleContainer)),this.moduleContainer.on("handlemove",this.wireHandleContainer.onhandlemove.bind(this.wireHandleContainer)),this.moduleContainer.on("handleend",this.wireHandleContainer.onhandleend.bind(this.wireHandleContainer)),this.moduleContainer.on("handleattach",this.wireHandleContainer.onhandleattach.bind(this.wireHandleContainer)),this.moduleContainer.on("handledetach",this.wireHandleContainer.onhandledetach.bind(this.wireHandleContainer))},p.prototype.onpoint=function(t){r.target(t)===this.el&&r.removeFocus()},p.prototype.onportevent=function(t){this.portEventHighlighted(t,!0),setTimeout(this.portEventHighlighted.bind(this),100,t,!1)},p.ModuleContainer=function(){var t=o.Component.inherits(function(){this.dragCount=this.prop(0),this.modules=[],this.bindings=[],this.retainer=new t.Retainer(r.find(this.el,".module-container-retainer"))});return t.prototype.bottomRightX=function(){return this.modules.reduce(function(t,e){return Math.max(e.bottomRightX(),t)},0)},t.prototype.bottomRightY=function(){return this.modules.reduce(function(t,e){return Math.max(e.bottomRightY(),t)},0)},t.prototype.retainerX=function(){return this.modules.length>0?this.bottomRightX()+this.retainer.margin():0},t.prototype.retainerY=function(){return this.modules.length>0?this.bottomRightY()+this.retainer.margin():0},t.prototype.portFromSocketPosition=function(t,e){for(var n=this.modules.length-1;n>=0;n--){var o=this.modules[n].portFromSocketPosition(t,e);if(o)return o}return null},t.prototype.connectedSourcePort=function(t){return i.find(this.bindings,function(e){return e.targetPort===t}).sourcePort},t.prototype.toData=function(){return{modules:this.modules.map(function(t){return t.toData()}),connections:this.bindings.map(function(t){return t.toData(this.modules)},this)}},t.prototype.createModule=function(t){var e=new a(null,t);return e.on("delete",this.ondelete.bind(this)),e.on("point",this.onpoint.bind(this)),e.on("portshow",this.onportshow.bind(this)),e.on("porthide",this.onporthide.bind(this)),e.on("portevent",this.emit.bind(this,"portevent")),e.on("dragstart",this.ondragstart.bind(this)),e.on("dragend",this.ondragend.bind(this)),e.on("plugdragstart",this.onplugdragstart.bind(this)),e.on("plugdragmove",this.onplugdragmove.bind(this)),e.on("plugdragend",this.onplugdragend.bind(this)),e.on("socketdragstart",this.onsocketdragstart.bind(this)),e.on("socketdragmove",this.onsocketdragmove.bind(this)),e.on("socketdragend",this.onsocketdragend.bind(this)),e},t.prototype.load=function(t){return this.loadModules(t.modules).then(function(e){return this.loadConnections(t.connections,e)}.bind(this))},t.prototype.loadModule=function(t,e,n){var o=this.createModule(t);return o.parentElement(this.el),this.modules.push(o),this.refresh(),o.load(e,n)},t.prototype.loadModules=function(t){return Promise.all(t.map(function(t){return this.loadModule(t.props,t.visiblePortNames,t.serializedValue)},this))},t.prototype.loadConnections=function(e,n){return Promise.resolve(e.map(function(e){return t.Binding.fromData(e,n)})).then(function(t){t.forEach(function(t){if(!this.canConnect(t.sourcePort,t.targetPort))throw new Error("Invalid connection");this.connect(t.sourcePort,t.targetPort)},this)}.bind(this))},t.prototype.removeModule=function(t){this.disconnectByModule(t),t.removeAllListeners(),t.parentElement(null),i.remove(this.modules,t),this.refresh()},t.prototype.clear=function(){this.modules.slice().reverse().forEach(function(t){this.removeModule(t)},this)},t.prototype.canConnect=function(t,e){return!(!t||!e)&&(t.type()===e.type()&&(!t.plugDisabled()&&!e.socketDisabled()&&(!(!t.visible()||!e.visible())&&!e.socketConnected())))},t.prototype.connect=function(t,e){this.attach(t,e),this.emit("connect",t,e)},t.prototype.disconnect=function(t,e){this.detach(t,e),this.emit("disconnect",t,e)},t.prototype.disconnectByModule=function(t){t.ports.forEach(function(t){this.disconnectByPort(t)},this)},t.prototype.disconnectByPort=function(t){this.bindings.slice().forEach(function(e){e.sourcePort!==t&&e.targetPort!==t||this.disconnect(e.sourcePort,e.targetPort)},this)},t.prototype.attach=function(t,e){this.bind(t,e),e.socketConnected(!0),e.socketHighlighted(t.plugHighlighted())},t.prototype.detach=function(t,e){this.unbind(t,e),e.socketConnected(!1),e.socketHighlighted(!1)},t.prototype.bind=function(e,n){s.bind(e.member,n.member),this.bindings.push(new t.Binding({sourcePort:e,targetPort:n}))},t.prototype.unbind=function(t,e){s.unbind(t.member,e.member),e.type()===u.TYPE_DATA&&e.member(null),i.remove(this.bindings,i.findLast(this.bindings,function(n){return n.sourcePort===t&&n.targetPort===e}))},t.prototype.portEventHighlighted=function(t,e){this.bindings.forEach(function(n){n.sourcePort===t&&n.targetPort.socketHighlighted(e)})},t.prototype.refresh=function(){this.modules.forEach(function(t,e){t.zIndex(e)}),0===this.dragCount()&&(this.retainer.x(this.retainerX()),this.retainer.y(this.retainerY()))},t.prototype.handlestart=function(t,e,n){t.incrementHighlightCount(),e&&e.incrementHighlightCount(),n.context={},this.emit("handlestart",t,e,n.context)},t.prototype.handlemove=function(t,e,n,o,i){var r=this.portFromSocketPosition(o,i);r&&e&&r===e||(this.emit("handlemove",t,e,n.context,o,i),e&&this.handledetach(t,e,n),(e=this.canConnect(t,r)?r:null)&&this.handleattach(t,e,n),n.targetPort=e)},t.prototype.handleend=function(t,e,n){t.decrementHighlightCount(),e&&e.decrementHighlightCount(),this.emit("handleend",t,e,n.context)},t.prototype.handleattach=function(t,e,n){this.attach(t,e),e.incrementHighlightCount(),this.emit("handleattach",t,e,n.context)},t.prototype.handledetach=function(t,e,n){this.detach(t,e),e.decrementHighlightCount(),this.emit("handledetach",t,e,n.context)},t.prototype.ondelete=function(t){this.removeModule(t)},t.prototype.onpoint=function(t){i.moveToBack(this.modules,t),this.refresh()},t.prototype.onportshow=function(){this.refresh()},t.prototype.onporthide=function(t){this.disconnectByPort(t),this.refresh()},t.prototype.ondragstart=function(){this.dragCount(this.dragCount()+1),this.emit("dragstart")},t.prototype.ondragend=function(){this.dragCount(this.dragCount()-1),this.refresh(),this.emit("dragend")},t.prototype.onplugdragstart=function(t,e){e.x=t.plugX(),e.y=t.plugY(),e.targetPort=null,this.handlestart(t,e.targetPort,e)},t.prototype.onplugdragmove=function(t,e,n,o){this.handlemove(t,e.targetPort,e,e.x+n,e.y+o)},t.prototype.onplugdragend=function(t,e){this.handleend(t,e.targetPort,e)},t.prototype.onsocketdragstart=function(t,e){e.x=t.socketX(),e.y=t.socketY(),e.sourcePort=this.connectedSourcePort(t),e.targetPort=t,this.handlestart(e.sourcePort,e.targetPort,e)},t.prototype.onsocketdragmove=function(t,e,n,o){this.handlemove(e.sourcePort,e.targetPort,e,e.x+n,e.y+o)},t.prototype.onsocketdragend=function(t,e){this.handleend(e.sourcePort,e.targetPort,e)},t.Binding=function(){var t=function(t){this.sourcePort=t.sourcePort,this.targetPort=t.targetPort};return t.prototype.toData=function(t){return{source:{moduleIndex:t.indexOf(this.sourcePort.module),portName:this.sourcePort.name()},target:{moduleIndex:t.indexOf(this.targetPort.module),portName:this.targetPort.name()}}},t.fromData=function(e,n){var o=n[e.source.moduleIndex],i=n[e.target.moduleIndex];return new t({sourcePort:o?o.port(e.source.portName):null,targetPort:i?i.port(e.target.portName):null})},t}(),t.Retainer=function(){var t=o.Component.inherits(function(){this.x=this.prop(0),this.y=this.prop(0),this.margin=this.prop(80)});return t.prototype.onredraw=function(){this.redrawBy("x","y",function(t,e){r.translate(this.el,t,e)})},t}(),t}(),p.WireContainer=function(){var t=o.Component.inherits(function(){this.lockRelations=[]});return t.prototype.lockedWires=function(t,e){return this.lockRelations.filter(function(n){return n.type===t&&n.port===e}).map(function(t){return t.wire})},t.prototype.attachedWire=function(t){return this.lockedWires(h.TYPE_SOCKET,t)[0]},t.prototype.createWire=function(t,e){return new l(null,{sourceX:t.plugX(),sourceY:t.plugY(),targetX:e?e.socketX():t.plugX(),targetY:e?e.socketY():t.plugY(),highlighted:t.plugHighlighted()})},t.prototype.lock=function(t,e,n){var o=new h({type:t,port:e,wire:n});e.addRelation(o),this.lockRelations.push(o)},t.prototype.unlock=function(t,e,n){var o=i.findLast(this.lockRelations,function(o){return o.type===t&&o.port===e&&o.wire===n});e.removeRelation(o),i.remove(this.lockRelations,o)},t.prototype.portEventHighlighted=function(t,e){this.lockedWires(h.TYPE_PLUG,t).forEach(function(t){t.highlighted(e)})},t.prototype.onconnect=function(t,e){var n=this.createWire(t,e);n.parentElement(this.el),this.lock(h.TYPE_PLUG,t,n),this.lock(h.TYPE_SOCKET,e,n)},t.prototype.ondisconnect=function(t,e){var n=this.attachedWire(e);n.parentElement(null),this.unlock(h.TYPE_PLUG,t,n),this.unlock(h.TYPE_SOCKET,e,n)},t.prototype.onhandlestart=function(t,e,n){n.wire=e?this.attachedWire(e):this.createWire(t,null),e||(n.wire.parentElement(this.el),this.lock(h.TYPE_PLUG,t,n.wire))},t.prototype.onhandlemove=function(t,e,n,o,i){n.wire.targetX(o),n.wire.targetY(i)},t.prototype.onhandleend=function(t,e,n){e||(this.unlock(h.TYPE_PLUG,t,n.wire),n.wire.parentElement(null))},t.prototype.onhandleattach=function(t,e,n){this.lock(h.TYPE_SOCKET,e,n.wire)},t.prototype.onhandledetach=function(t,e,n){this.unlock(h.TYPE_SOCKET,e,n.wire)},t}(),p.WireHandleContainer=function(){var t=o.Component.inherits(function(){this.wireHandles=[]});return t.prototype.createWireHandle=function(t,e){return new d(null,{cx:e?e.socketX():t.plugX(),cy:e?e.socketY():t.plugY(),type:t.type(),visible:!e,highlighted:t.plugHighlighted(),port:t})},t.prototype.portEventHighlighted=function(t,e){this.wireHandles.forEach(function(n){n.port===t&&n.highlighted(e)})},t.prototype.onhandlestart=function(t,e,n){n.wireHandle=this.createWireHandle(t,e),n.wireHandle.parentElement(this.el),this.wireHandles.push(n.wireHandle)},t.prototype.onhandlemove=function(t,e,n,o,i){n.wireHandle.cx(o),n.wireHandle.cy(i)},t.prototype.onhandleend=function(t,e,n){n.wireHandle.parentElement(null),i.remove(this.wireHandles,n.wireHandle)},t.prototype.onhandleattach=function(t,e,n){n.wireHandle.visible(!1)},t.prototype.onhandledetach=function(t,e,n){n.wireHandle.visible(!0)},t}(),void 0!==e&&e.exports?e.exports=p:n.MainContent=p}(this.app||(this.app={}))},{"../dom.js":17,"../helper.js":18,"../models/circuit-module.js":19,"../relations/lock-relation.js":22,"./module-port.js":8,"./module.js":9,"./wire-handle.js":15,"./wire.js":16,jcore:void 0}],6:[function(t,e,n){!function(n){"use strict";var o=t("jcore"),i=n.dom||t("../dom.js"),r=n.Button||t("./button.js"),s=n.LoadButton||t("./load-button.js"),h=n.ToggleButton||t("./toggle-button.js"),a=o.Component.inherits(function(){this.sidebarToggleButton=new h(i.find(this.el,".sidebar-toggle-button")),this.loadButton=new s(i.find(this.el,".load-button")),this.saveButton=new r(i.find(this.el,".save-button"))});a.prototype.oninit=function(){this.sidebarToggleButton.on("toggle",this.emit.bind(this,"sidebartoggle")),this.loadButton.on("load",this.emit.bind(this,"load")),this.saveButton.on("tap",this.emit.bind(this,"save"))},void 0!==e&&e.exports?e.exports=a:n.MainHeader=a}(this.app||(this.app={}))},{"../dom.js":17,"./button.js":3,"./load-button.js":4,"./toggle-button.js":14,jcore:void 0}],7:[function(t,e,n){!function(n){"use strict";var o=t("file-saver"),i=t("jcore"),r=n.dom||t("../dom.js"),s=n.MainContent||t("./main-content.js"),h=n.MainHeader||t("./main-header.js"),a=i.Component.inherits(function(){this.disabled=this.prop(!0),this.isFullWidth=this.prop(!1),this.header=new h(r.find(this.el,".main-header")),this.content=new s(r.find(this.el,".main-content"))});a.prototype.contentOffsetLeft=function(){return this.content.offsetLeft()},a.prototype.contentOffsetTop=function(){return this.content.offsetTop()},a.prototype.toggleSidebar=function(){this.isFullWidth(!this.isFullWidth())},a.prototype.loadFile=function(t){return r.readFile(t).then(function(t){return this.loadContent(JSON.parse(t))}.bind(this))},a.prototype.loadUrl=function(t){return r.loadJSON(t).then(function(t){return this.loadContent(t)}.bind(this))},a.prototype.loadContent=function(t){return this.content.clear(),this.content.load(t)},a.prototype.loadModule=function(t,e){return this.content.loadModule(t,e)},a.prototype.oninit=function(){this.header.on("sidebartoggle",this.onsidebartoggle.bind(this)),this.header.on("load",this.onload.bind(this)),this.header.on("save",this.onsave.bind(this)),this.content.on("dragstart",this.emit.bind(this,"dragstart")),this.content.on("dragend",this.emit.bind(this,"dragend"))},a.prototype.onredraw=function(){this.redrawBy("disabled",function(t){r.toggleClass(this.el,"disabled",t)}),this.redrawBy("isFullWidth",function(t){r.toggleClass(this.el,"full-width",t)})},a.prototype.onsidebartoggle=function(t){this.toggleSidebar(),this.emit("sidebartoggle"),r.once(this.el,"transitionend",function(){t()})},a.prototype.onload=function(t){this.emit("loadstart"),this.loadFile(t).catch(function(t){alert(t)}).then(function(){this.emit("loadend")}.bind(this))},a.prototype.onsave=function(){var t=JSON.stringify(this.content.toData()),e=new Blob([t],{type:"application/json"});o.saveAs(e,"Untitled.json")},void 0!==e&&e.exports?e.exports=a:n.Main=a}(this.app||(this.app={}))},{"../dom.js":17,"./main-content.js":5,"./main-header.js":6,"file-saver":void 0,jcore:void 0}],8:[function(t,e,n){!function(n){"use strict";var o=t("jcore"),i=n.dom||t("../dom.js"),r=o.Component.inherits(function(t,e){this.label=this.prop(e.label),this.name=this.prop(e.name),this.type=this.prop(e.type),this.plugDisabled=this.prop(e.plugDisabled),this.socketDisabled=this.prop(e.socketDisabled),this.offsetX=this.prop(e.offsetX),this.offsetY=this.prop(e.offsetY),this.top=this.prop(0),this.highlightCount=this.prop(0),this.isMoving=this.prop(!1),this.height=this.prop(44),this.plugOffsetX=this.prop(261),this.plugWidth=this.prop(50),this.socketOffsetX=this.prop(-25),this.socketWidth=this.prop(50),this.member=e.member,this.module=e.module,this.plug=new r.Handle(i.find(this.el,".module-port-plug")),this.socket=new r.Socket(i.find(this.el,".module-port-socket")),this.socketHandle=new r.Handle(i.find(this.el,".module-port-socket-handle")),this.content=new r.Content(i.find(this.el,".module-port-content"))});r.prototype.hideButtonElement=function(){return i.find(this.el,".module-port-hide-button")},r.prototype.visible=function(){return null!==this.parentElement()},r.prototype.middle=function(){return this.top()+this.height()/2},r.prototype.bottom=function(){return this.top()+this.height()},r.prototype.plugX=function(){return this.offsetX()+this.plugOffsetX()},r.prototype.plugY=function(){return this.offsetY()+this.middle()},r.prototype.socketX=function(){return this.offsetX()+this.socketOffsetX()},r.prototype.socketY=function(){return this.offsetY()+this.middle()},r.prototype.highlighted=function(){return 0!==this.highlightCount()},r.prototype.plugHighlighted=function(t){return this.plug.highlighted(t)},r.prototype.socketHighlighted=function(t){return this.socketHandle.highlighted(t),this.socket.highlighted(t)},r.prototype.socketConnected=function(t){return this.socketHandle.visible(t)},r.prototype.incrementHighlightCount=function(){this.highlightCount(this.highlightCount()+1),1===this.highlightCount()&&this.emit("highlight",this)},r.prototype.decrementHighlightCount=function(){this.highlightCount(this.highlightCount()-1),0===this.highlightCount()&&this.emit("unhighlight",this)},r.prototype.render=function(){return i.render(r.HTML_TEXT)},r.prototype.oninit=function(){this.plug.visible(!this.plugDisabled()),this.socket.visible(!this.socketDisabled()),this.socketHandle.visible(!1),this.content.label(this.label())},r.prototype.onredraw=function(){this.redrawBy("type",function(t){i.data(this.el,"type",t)}),this.redrawBy("top",function(t){i.translateY(this.el,t)}),this.redrawBy("highlighted",function(t){i.toggleClass(this.el,"highlighted",t),i.toggleClass(this.hideButtonElement(),"disabled",t)}),this.redrawBy("isMoving",function(t){i.toggleClass(this.el,"moving",t)})},r.TYPE_DATA="data",r.TYPE_EVENT="event",r.HTML_TEXT=['<div class="module-port">','<div class="module-port-plug module-port-handle"></div>','<div class="module-port-socket">','<div class="module-port-socket-handle module-port-handle"></div>',"</div>",'<div class="module-port-content"></div>','<div class="module-port-hide-button"><svg class="module-port-hide-button-content" width="100%" height="100%" viewBox="-896 -896 3584 3584"><path d="M1344 800v64q0 14-9 23t-23 9h-832q-14 0-23-9t-9-23v-64q0-14 9-23t23-9h832q14 0 23 9t9 23zm128 448v-832q0-66-47-113t-113-47h-832q-66 0-113 47t-47 113v832q0 66 47 113t113 47h832q66 0 113-47t47-113zm128-832v832q0 119-84.5 203.5t-203.5 84.5h-832q-119 0-203.5-84.5t-84.5-203.5v-832q0-119 84.5-203.5t203.5-84.5h832q119 0 203.5 84.5t84.5 203.5z" fill="#212121"/></svg></div>',"</div>"].join(""),r.Handle=function(){var t=o.Component.inherits(function(){this.visible=this.prop(!0),this.highlighted=this.prop(!1)});return t.prototype.onredraw=function(){this.redrawBy("visible",function(t){i.toggleClass(this.el,"hide",!t)}),this.redrawBy("highlighted",function(t){i.toggleClass(this.el,"highlighted",t)})},t}(),r.Socket=r.Handle,r.Content=function(){var t=o.Component.inherits(function(){this.label=this.prop("")});return t.prototype.onredraw=function(){this.redrawBy("label",function(t){i.text(this.el,t)})},t}(),void 0!==e&&e.exports?e.exports=r:n.ModulePort=r}(this.app||(this.app={}))},{"../dom.js":17,jcore:void 0}],9:[function(t,e,n){!function(n){"use strict";var o=t("jcore"),i=n.helper||t("../helper.js"),r=n.dom||t("../dom.js"),s=n.CircuitModule||t("../models/circuit-module.js"),h=n.ModulePort||t("./module-port.js"),a=o.Component.inherits(function(t,e){this.title=this.prop(e.title),this.name=this.prop(e.name),this.x=this.prop(e.x),this.y=this.prop(e.y),this.width=this.prop(240),this.zIndex=this.prop("auto"),this.isLoading=this.prop(!1),this.isError=this.prop(!1),this.isMoving=this.prop(!1),this.isDeleting=this.prop(!1),this.ports=[],this.header=new a.Header(r.find(this.el,".module-header")),this.footer=new a.Footer(r.find(this.el,".module-footer")),this.component=new a.Component(r.find(this.el,".module-component")),this.portList=new a.PortList(r.find(this.el,".module-port-list")),this.portSelect=new a.PortSelect(r.find(this.el,".module-port-select")),this.draggable=new a.Draggable(this)});a.prototype.height=function(){return this.header.height()+this.footer.height()+this.component.outerHeight()+this.portList.height()},a.prototype.bottomRightX=function(){return this.x()+this.width()+this.rightPadding()},a.prototype.bottomRightY=function(){return this.y()+this.height()},a.prototype.portOffsetX=function(){return this.x()},a.prototype.portOffsetY=function(){return this.y()+this.header.height()+this.component.outerHeight()},a.prototype.rightPadding=function(){return this.visiblePorts().map(function(t){return t.plugDisabled()?0:t.plugWidth()}).reduce(function(t,e){return Math.max(t,e)},0)},a.prototype.leftPadding=function(){return this.visiblePorts().map(function(t){return t.socketDisabled()?0:t.socketWidth()}).reduce(function(t,e){return Math.max(t,e)},0)},a.prototype.port=function(t){return i.find(this.ports,function(e){return e.name()===t})},a.prototype.targetPort=function(t){return i.find(this.ports,function(e){return r.contains(e.el,t)})},a.prototype.visiblePorts=function(){return this.portList.ports.slice()},a.prototype.portFromSocketPosition=function(t,e){return 0===this.ports.length?null:Math.abs(t-this.ports[0].socketX())>18?null:i.findLast(this.ports,function(t){return Math.abs(e-t.socketY())<=18&&t.visible()&&!t.socketDisabled()})},a.prototype.url=function(){return"modular_modules/"+encodeURI(this.name())+".html"},a.prototype.footerDisabled=function(){return this.visiblePorts().length===this.ports.length},a.prototype.toData=function(){return{props:{title:this.title(),name:this.name(),x:this.x(),y:this.y()},visiblePortNames:this.visiblePorts().sort(function(t,e){return t.top()-e.top()}).map(function(t){return t.name()}),serializedValue:this.component.serialize()}},a.prototype.createPort=function(t){var e=new h(null,t);return e.on("highlight",this.onporthighlight.bind(this)),e.on("unhighlight",this.onportunhighlight.bind(this)),e},a.prototype.createPorts=function(t){return t.map(function(t){return this.createPort(i.extend({offsetX:this.portOffsetX(),offsetY:this.portOffsetY(),member:t,module:this},t))},this)},a.prototype.setPorts=function(t,e){this.ports=t,this.portSelect.set(t),e.forEach(function(t){this.showPort(t)},this)},a.prototype.removePortsAllListeners=function(){this.ports.forEach(function(t){t.removeAllListeners()})},a.prototype.load=function(t,e){return this.isLoading(!0),this.redraw(),this.component.load(this.url()).then(function(n){return this.setPorts(this.createPorts(n.members),t),this.component.deserialize(e),this.isLoading(!1),this}.bind(this)).catch(function(t){throw this.isError(!0),t}.bind(this))},a.prototype.moveX=function(t){this.x(Math.max(t,this.leftPadding())),this.visiblePorts().forEach(function(t){t.offsetX(this.portOffsetX())},this)},a.prototype.moveY=function(t){this.y(Math.max(t,0)),this.visiblePorts().forEach(function(t){t.offsetY(this.portOffsetY())},this)},a.prototype.showPort=function(t){var e=this.port(t);e&&!e.visible()&&(e.offsetX(this.portOffsetX()),e.offsetY(this.portOffsetY()),this.portList.add(e),this.portSelect.remove(e),this.footer.disabled(this.footerDisabled()),this.moveX(this.x()),this.emit("portshow",e))},a.prototype.hidePort=function(t){var e=this.port(t);e&&e.visible()&&(this.portList.remove(e),this.portSelect.add(e),this.footer.disabled(this.footerDisabled()),this.emit("porthide",e))},a.prototype.render=function(){return r.render(a.HTML_TEXT)},a.prototype.oninit=function(){this.header.text(this.title())},a.prototype.onappend=function(){this.draggable.enable(),this.component.on("point",this.emit.bind(this,"point",this)),this.component.on("event",this.onportevent.bind(this)),this.portSelect.on("point",this.emit.bind(this,"point",this)),this.portSelect.on("select",this.onselect.bind(this)),this.portSelect.onappend()},a.prototype.onremove=function(){this.removePortsAllListeners(),this.draggable.disable(),this.component.unload(),this.component.removeAllListeners(),this.portSelect.removeAllListeners(),this.portSelect.onremove()},a.prototype.onredraw=function(){this.redrawBy("x","y",function(t,e){r.translate(this.el,t,e)}),this.redrawBy("zIndex",function(t){r.css(this.el,{zIndex:t})}),this.redrawBy("isLoading",function(t){r.toggleClass(this.el,"loading",t)}),this.redrawBy("isError",function(t){r.toggleClass(this.el,"error",t)}),this.redrawBy("isMoving",function(t){r.toggleClass(this.el,"moving",t)}),this.redrawBy("isDeleting",function(t){r.toggleClass(this.el,"deleting",t)})},a.prototype.onportevent=function(t){this.emit("portevent",this.port(t.name))},a.prototype.onselect=function(t){this.showPort(t)},a.prototype.onporthighlight=function(){this.header.incrementDeletableCount()},a.prototype.onportunhighlight=function(){this.header.decrementDeletableCount()},a.HTML_TEXT=['<div class="module">','<div class="module-header">','<div class="module-title module-header-item"></div>','<div class="module-delete-button module-header-item"></div>',"</div>",'<div class="module-content">','<div class="module-component module-content-item embed">','<iframe class="module-component-content"></iframe>',"</div>",'<div class="module-port-list module-content-item"></div>',"</div>",'<div class="module-footer">','<svg class="module-footer-icon module-footer-item" width="1792" height="1792" viewBox="0 0 1792 1792"><path d="M1408 704q0 26-19 45l-448 448q-19 19-45 19t-45-19l-448-448q-19-19-19-45t19-45 45-19h896q26 0 45 19t19 45z" fill="#fff"/></svg>','<select class="module-port-select module-footer-item">','<optgroup data-type="data" label="Data"></optgroup>','<optgroup data-type="event" label="Event"></optgroup>',"</select>","</div>","</div>"].join(""),a.Header=function(){var t=o.Component.inherits(function(){this.text=this.prop(""),this.deletableCount=this.prop(0),this.height=this.prop(32)});return t.prototype.titleElement=function(){return r.find(this.el,".module-title")},t.prototype.deleteButtonElement=function(){return r.find(this.el,".module-delete-button")},t.prototype.deleteButtonDisabled=function(){return 0!==this.deletableCount()},t.prototype.incrementDeletableCount=function(){this.deletableCount(this.deletableCount()+1)},t.prototype.decrementDeletableCount=function(){this.deletableCount(this.deletableCount()-1)},t.prototype.onredraw=function(){this.redrawBy("text",function(t){r.text(this.titleElement(),t)}),this.redrawBy("deleteButtonDisabled",function(t){r.toggleClass(this.deleteButtonElement(),"disabled",t)})},t}(),a.Footer=function(){var t=o.Component.inherits(function(){this.disabled=this.prop(!1)});return t.prototype.height=function(){return this.disabled()?0:21},t.prototype.onredraw=function(){this.redrawBy("disabled",function(t){r.toggleClass(this.el,"hide",t)})},t}(),a.Component=function(){var t=o.Component.inherits(function(){this.height=this.prop(0),this.members=[],this.eventMembers=[],this.options=this.createDefaultOptions(),this.onpoint=this.emit.bind(this,"point")});return t.prototype.contentElement=function(){return r.find(this.el,".module-component-content")},t.prototype.outerHeight=function(){return this.height()+1},t.prototype.contentWindow=function(){return r.contentWindow(this.contentElement())},t.prototype.circuitModule=function(){var t=this.contentWindow().modular;return t&&t.exports},t.prototype.member=function(t){return i.findLast(this.members,function(e){return e.name===t})},t.prototype.createEventCircuitModule=function(){return new s.ModularModule(this.members.filter(function(t){return"event"===t.type}).map(function(t){return i.extend({arg:this.emit.bind(this,"event",t)},t)},this))},t.prototype.bindEventMembers=function(){this.eventMembers.forEach(function(t){s.bind(this.member(t.name),t)},this)},t.prototype.unbindEventMembers=function(){this.eventMembers.forEach(function(t){s.unbind(this.member(t.name),t)},this)},t.prototype.createDefaultOptions=function(){return{serialize:function(){return null},deserialize:function(){}}},t.prototype.serialize=function(){var t=this.options.serialize();return null!=t?String(t):null},t.prototype.deserialize=function(t){null!=t&&this.options.deserialize(String(t))},t.prototype.load=function(t){return new Promise(function(e,n){var o=this.contentElement(),i=setTimeout(n,3e4,new Error("Load timeout for content"));r.once(o,"load",function(){clearTimeout(i),e(this.circuitModule())}.bind(this)),r.attr(o,{src:t})}.bind(this)).then(function(t){if(!t)throw new Error("Invalid circuit module");var e=this.contentElement();return this.height(r.contentHeight(e)),r.css(e,{height:this.height()+"px"}),r.css(this.el,{height:this.height()+"px"}),r.on(this.contentWindow(),r.eventType("start"),this.onpoint,!0),this.members=t.getAll(),this.eventMembers=this.createEventCircuitModule().getAll(),this.bindEventMembers(),i.extend(this.options,t.options),this}.bind(this))},t.prototype.unload=function(){r.off(this.contentWindow(),r.eventType("start"),this.onpoint,!0),this.unbindEventMembers()},t}(),a.PortList=function(){var t=o.Component.inherits(function(){this.ports=[]});return t.prototype.height=function(){return this.ports.reduce(function(t,e){return t+e.height()},0)},t.prototype.add=function(t){t.top(this.height()),t.parentElement(this.el),this.ports.push(t),this.markDirty()},t.prototype.remove=function(t){i.remove(this.ports,t),t.parentElement(null),this.ports.forEach(function(e){e.top()>t.top()&&e.top(e.top()-t.height())}),this.markDirty()},t.prototype.onredraw=function(){this.redrawBy("height",function(t){r.css(this.el,{height:t+"px"})})},t}(),a.PortSelect=function(){var t=o.Component.inherits(function(){this.ports=[],this.options=[],this.onpoint=this.onpoint.bind(this),this.onchange=this.onchange.bind(this)});return t.prototype.optGroupElement=function(t){return r.find(this.el,'optgroup[data-type="'+t+'"]')},t.prototype.set=function(t){this.ports=t.slice(),this.markDirty()},t.prototype.add=function(t){this.ports.push(t),this.markDirty()},t.prototype.remove=function(t){i.remove(this.ports,t),this.markDirty()},t.prototype.createOption=function(e){return new t.Option(null,{label:e.label(),name:e.name()})},t.prototype.onappend=function(){r.on(this.el,r.eventType("start"),this.onpoint),r.on(this.el,"change",this.onchange)},t.prototype.onremove=function(){r.off(this.el,r.eventType("start"),this.onpoint),r.off(this.el,"change",this.onchange)},t.prototype.onredraw=function(){this.options.forEach(function(t){t.parentElement(null),t.redraw()}),this.options=i.sortBy(this.ports,function(t){return t.label()}).map(function(t){var e=this.createOption(t);return e.parentElement(this.optGroupElement(t.type())),e.redraw(),e},this),r.value(this.el,"")},t.prototype.onpoint=function(t){r.stop(t),this.emit("point")},t.prototype.onchange=function(t){r.removeFocus(),this.emit("select",r.value(r.target(t)))},t.Option=function(){var t=o.Component.inherits(function(t,e){this.label=this.prop(e.label),this.name=this.prop(e.name)});return t.prototype.render=function(){return r.render(t.HTML_TEXT)},t.prototype.onredraw=function(){this.redrawBy("label",function(t){r.text(this.el,t)}),this.redrawBy("name",function(t){r.value(this.el,t)})},t.HTML_TEXT="<option></option>",t}(),t}(),a.Draggable=function(){var t=o.Draggable.inherits(function(){this.listenersList=[]});return t.prototype.onstart=function(e,n,o,i,s){e.emit("point",e),s.listeners=t.listenersByTarget(r.target(i),this.listenersList),s.listeners&&(this.listenersList.push(s.listeners),r.cancel(i),e.emit("dragstart"),s.listeners.onstart(e,n,o,i,s))},t.prototype.onmove=function(t,e,n,o,i){i.listeners&&i.listeners.onmove(t,e,n,o,i)},t.prototype.onend=function(t,e,n,o,r){r.listeners&&(i.remove(this.listenersList,r.listeners),t.emit("dragend"),r.listeners.onend(t,e,n,o,r))},t.titleListeners={onstart:function(t,e,n,o,i){i.x=t.x(),i.y=t.y(),t.isMoving(!0)},onmove:function(t,e,n,o,i){t.moveX(i.x+e),t.moveY(i.y+n)},onend:function(t,e,n,o,i){t.isMoving(!1)}},t.deleteButtonListeners={onstart:function(t,e,n,o,i){i.target=r.target(o),t.isDeleting(!0)},onmove:function(t,e,n,o,i){t.isDeleting(r.target(o)===i.target)},onend:function(t,e,n,o,i){t.isDeleting(!1),r.target(o)===i.target&&t.emit("delete",t)}},t.portHideButtonListeners={onstart:function(t,e,n,o,i){i.target=r.target(o)},onmove:function(){},onend:function(t,e,n,o,i){if(r.target(o)===i.target){var s=t.targetPort(i.target).name();t.hidePort(s)}}},t.portContentListeners={onstart:function(t,e,n,o,i){var s=t.targetPort(r.target(o)),h=s.top();i.port=s,i.top=h,i.placeholderTop=h,s.isMoving(!0)},onmove:function(t,e,n,o,r){var s=r.port;s.top(i.clamp(r.top+n,0,t.portList.height()-s.height())),s.top()-r.placeholderTop>0?this.onmovedown(t,e,n,o,r):this.onmoveup(t,e,n,o,r)},onmovedown:function(t,e,n,o,i){var r=i.port,s=r.height(),h=r.middle(),a=i.placeholderTop;t.visiblePorts().filter(function(t){var e=t.top();return t!==r&&a<=e&&e<h}).forEach(function(t){t.top(t.top()-s),a=Math.max(a,t.bottom())}),i.placeholderTop=a},onmoveup:function(t,e,n,o,i){var r=i.port,s=r.height(),h=r.middle(),a=i.placeholderTop;t.visiblePorts().filter(function(t){var e=t.bottom();return t!==r&&h<e&&e<=a}).forEach(function(t){var e=t.top();t.top(e+s),a=Math.min(a,e)}),i.placeholderTop=a},onend:function(t,e,n,o,i){var r=i.port;r.top(i.placeholderTop),r.isMoving(!1)}},t.portPlugListeners={onstart:function(t,e,n,o,i){i.port=t.targetPort(r.target(o)),i.context={},t.emit("plugdragstart",i.port,i.context)},onmove:function(t,e,n,o,i){t.emit("plugdragmove",i.port,i.context,e,n)},onend:function(t,e,n,o,i){t.emit("plugdragend",i.port,i.context)}},t.portSocketHandleListeners={onstart:function(t,e,n,o,i){i.port=t.targetPort(r.target(o)),i.context={},t.emit("socketdragstart",i.port,i.context)},onmove:function(t,e,n,o,i){t.emit("socketdragmove",i.port,i.context,e,n)},onend:function(t,e,n,o,i){t.emit("socketdragend",i.port,i.context)}},t.isListenersAllowed={move:function(e){return 0===e.length||e.every(function(e){return e===t.portPlugListeners||e===t.portSocketHandleListeners})},remove:function(t){return 0===t.length},change:function(e){return 0===e.length||e.every(function(e){return e!==t.deleteButtonListeners&&e!==t.portHideButtonListeners})}},t.listenersByTarget=function(){var e=[{className:"module-title",listeners:t.titleListeners,isAllowed:t.isListenersAllowed.move},{className:"module-delete-button",listeners:t.deleteButtonListeners,isAllowed:t.isListenersAllowed.remove},{className:"module-port-hide-button",listeners:t.portHideButtonListeners,isAllowed:t.isListenersAllowed.remove},{className:"module-port-content",listeners:t.portContentListeners,isAllowed:t.isListenersAllowed.move},{className:"module-port-plug",listeners:t.portPlugListeners,isAllowed:t.isListenersAllowed.change},{className:"module-port-socket-handle",listeners:t.portSocketHandleListeners,isAllowed:t.isListenersAllowed.change}];return function(t,n){var o=i.find(e,function(e){return r.hasClass(t,e.className)});return o&&o.isAllowed(n)?o.listeners:null}}(),t}(),void 0!==e&&e.exports?e.exports=a:n.Module=a}(this.app||(this.app={}))},{"../dom.js":17,"../helper.js":18,"../models/circuit-module.js":19,"./module-port.js":8,jcore:void 0}],10:[function(t,e,n){!function(n){"use strict";var o=t("iscroll"),i=t("jcore"),r=n.dom||t("../dom.js"),s=n.SidebarModule||t("./sidebar-module.js"),h=i.Component.inherits(function(){this.modules=[],this.scrollable=new h.Scrollable(this.el)});h.prototype.createModule=function(t){var e=new s(null,t);return e.on("dragstart",this.emit.bind(this,"dragstart")),e.on("dragend",this.emit.bind(this,"dragend")),e.on("drop",this.emit.bind(this,"drop")),e},h.prototype.createModules=function(t){return t.map(function(t){return this.createModule({title:t.label,content:t.description,name:t.name})},this)},h.prototype.reload=function(t){this.modules.forEach(function(t){t.removeAllListeners(),t.parentElement(null)}),this.modules=this.createModules(t).map(function(t){return t.parentElement(r.find(this.el,".sidebar-module-container")),t},this),this.markDirty()},h.prototype.scrollEnabled=function(t){this.scrollable.enabled(t)},h.prototype.oninit=function(){r.on(this.el,r.eventType("start"),function(){r.removeFocus()})},h.prototype.onredraw=function(){this.scrollable.refresh()},h.Scrollable=function(){var t=function(t){this.iScroll=new o(t,this.options())};return t.prototype.options=function(){return{disableMouse:!0,disablePointer:!r.supportsTouch(),fadeScrollbars:r.supportsTouch(),interactiveScrollbars:!r.supportsTouch(),mouseWheel:!0,scrollbars:!0}},t.prototype.enabled=function(t){t?this.iScroll.enable():this.iScroll.disable()},t.prototype.refresh=function(){setTimeout(function(){this.iScroll.refresh()}.bind(this),0)},t}(),void 0!==e&&e.exports?e.exports=h:n.SidebarContent=h}(this.app||(this.app={}))},{"../dom.js":17,"./sidebar-module.js":12,iscroll:void 0,jcore:void 0}],11:[function(t,e,n){!function(n){"use strict";var o=t("jcore"),i=n.dom||t("../dom.js"),r=o.Component.inherits(function(){this.searchInput=new r.SearchInput(i.find(this.el,".search-input"))});r.prototype.loadSearchText=function(){this.searchInput.oninput()},r.prototype.oninit=function(){this.searchInput.on("input",this.emit.bind(this,"search"))},r.SearchInput=function(){var t=o.Component.inherits(function(){this.isFocused=this.prop(!1)});return t.prototype.oninit=function(){this.isFocused(i.isFocused(this.el)),i.on(this.el,i.eventType("start"),this.onpoint.bind(this)),i.on(this.el,"click",this.onclick.bind(this)),i.on(this.el,"input",this.oninput.bind(this)),i.on(this.el,"focus",this.onfocus.bind(this))},t.prototype.onpoint=function(){this.isFocused(i.isFocused(this.el))},t.prototype.onclick=function(){this.isFocused()||i.hasSelection(this.el)||i.selectAll(this.el)},t.prototype.oninput=function(){this.emit("input",i.value(this.el))},t.prototype.onfocus=function(){i.hasSelection(this.el)&&i.clearSelection(this.el)},t}(),void 0!==e&&e.exports?e.exports=r:n.SidebarHeader=r}(this.app||(this.app={}))},{"../dom.js":17,jcore:void 0}],12:[function(t,e,n){!function(n){"use strict";var o=t("jcore"),i=n.dom||t("../dom.js"),r=o.Component.inherits(function(t,e){this.title=this.prop(e.title),this.content=this.prop(e.content),this.name=this.prop(e.name),this.isActive=this.prop(!1),this.draggable=new r.Draggable(this)});r.prototype.headerElement=function(){return i.find(this.el,".sidebar-module-header")},r.prototype.contentElement=function(){return i.find(this.el,".sidebar-module-content")},r.prototype.createClone=function(t,e){return new r.Clone(i.clone(this.el),t,e)},r.prototype.render=function(){return i.render(r.HTML_TEXT)},r.prototype.onappend=function(){this.draggable.enable()},r.prototype.onremove=function(){this.draggable.disable()},r.prototype.onredraw=function(){this.redrawBy("isActive",function(t){i.toggleClass(this.el,"active",t)}),this.redrawBy("title",function(t){i.text(this.headerElement(),t)}),this.redrawBy("content",function(t){i.text(this.contentElement(),t)})},r.HTML_TEXT=['<div class="sidebar-module hoverable">','<div class="sidebar-module-header sidebar-module-item"></div>','<div class="sidebar-module-content sidebar-module-item"></div>',"</div>"].join(""),r.Clone=function(){var t=o.Component.inherits(function(t,e,n){this.x=this.prop(e),this.y=this.prop(n)});return t.prototype.oninit=function(){i.addClass(this.el,"clone")},t.prototype.onredraw=function(){this.redrawBy("x","y",function(t,e){i.translate(this.el,t,e)})},t}(),r.Draggable=function(){var t=o.Draggable.inherits();return t.prototype.onstart=function(t,e,n,o,r){i.cancel(o),t.isActive(!0),i.supportsTouch()?(r.dragging=!1,r.timeoutID=setTimeout(this.ondragstart.bind(this),300,t,e,n,o,r)):this.ondragstart(t,e,n,o,r)},t.prototype.onmove=function(t,e,n,o,i){i.dragging?this.ondragmove(t,e,n,o,i):i.timeoutID&&(Math.abs(e)>5||Math.abs(n)>5)&&(t.isActive(!1),clearTimeout(i.timeoutID),i.timeoutID=0)},t.prototype.onend=function(t,e,n,o,i){t.isActive(!1),i.dragging?this.ondragend(t,e,n,o,i):i.timeoutID&&(clearTimeout(i.timeoutID),i.timeoutID=0)},t.prototype.ondragstart=function(t,e,n,o,r){r.dragging=!0,r.timeoutID=0,r.x=i.offsetLeft(t.el),r.y=i.offsetTop(t.el),r.clone=t.createClone(r.x,r.y),r.clone.parentElement(i.body()),t.emit("dragstart")},t.prototype.ondragmove=function(t,e,n,o,i){i.clone.x(i.x+e),i.clone.y(i.y+n)},t.prototype.ondragend=function(t,e,n,o,i){i.dragging=!1,i.clone.parentElement(null),t.emit("dragend"),t.emit("drop",t.name(),i.x+e,i.y+n)},t}(),void 0!==e&&e.exports?e.exports=r:n.SidebarModule=r}(this.app||(this.app={}))},{"../dom.js":17,jcore:void 0}],13:[function(t,e,n){!function(n){"use strict";var o=t("jcore"),i=n.dom||t("../dom.js"),r=n.EntryCollection||t("../models/entry-collection.js"),s=n.SidebarContent||t("./sidebar-content.js"),h=n.SidebarHeader||t("./sidebar-header.js"),a=o.Component.inherits(function(){this.disabled=this.prop(!0),this.dragCount=this.prop(0),this.entryCollection=new r({jsonLoader:i.loadJSON}),this.header=new h(i.find(this.el,".sidebar-header")),this.content=new s(i.find(this.el,".sidebar-content"))});a.prototype.scrollEnabled=function(){return 0===this.dragCount()},a.prototype.incrementDragCount=function(){this.dragCount(this.dragCount()+1)},a.prototype.decrementDragCount=function(){this.dragCount(this.dragCount()-1)},a.prototype.entry=function(t){return this.entryCollection.get(t)},a.prototype.search=function(t){this.content.reload(this.entryCollection.search(t))},a.prototype.loadEntries=function(){return this.entryCollection.load().then(function(){this.header.loadSearchText()}.bind(this))},a.prototype.oninit=function(){this.header.on("search",this.onsearch.bind(this)),this.content.on("dragstart",this.ondragstart.bind(this)),this.content.on("dragend",this.ondragend.bind(this)),this.content.on("drop",this.emit.bind(this,"drop"))},a.prototype.onredraw=function(){this.redrawBy("disabled",function(t){i.toggleClass(this.el,"disabled",t)}),this.redrawBy("scrollEnabled",function(t){this.content.scrollEnabled(t)})},a.prototype.onsearch=function(t){this.search(t)},a.prototype.ondragstart=function(){this.incrementDragCount(),this.emit("dragstart")},a.prototype.ondragend=function(){this.decrementDragCount(),this.emit("dragend")},void 0!==e&&e.exports?e.exports=a:n.Sidebar=a}(this.app||(this.app={}))},{"../dom.js":17,"../models/entry-collection.js":20,"./sidebar-content.js":10,"./sidebar-header.js":11,jcore:void 0}],14:[function(t,e,n){!function(n){"use strict";var o=t("jcore"),i=n.dom||t("../dom.js"),r=n.Button||t("./button.js"),s=o.Component.inherits(function(){this.types=["collapse","expand"],this.currentIndex=this.prop(0),this.button=new r(this.el)});s.prototype.toggle=function(){this.currentIndex((this.currentIndex()+1)%this.types.length)},s.prototype.done=function(){this.toggle(),this.button.disabled(!1)},s.prototype.oninit=function(){this.button.on("tap",this.ontap.bind(this))},s.prototype.onredraw=function(){this.redrawBy("currentIndex",function(t){i.data(this.el,"type",this.types[t])})},s.prototype.ontap=function(){this.button.disabled(!0),this.emit("toggle",this.done.bind(this))},void 0!==e&&e.exports?e.exports=s:n.ToggleButton=s}(this.app||(this.app={}))},{"../dom.js":17,"./button.js":3,jcore:void 0}],15:[function(t,e,n){!function(n){"use strict";var o=t("jcore"),i=n.dom||t("../dom.js"),r=o.Component.inherits(function(t,e){this.cx=this.prop(e.cx),this.cy=this.prop(e.cy),this.type=this.prop(e.type),this.visible=this.prop(e.visible),this.highlighted=this.prop(e.highlighted),this.width=this.prop(24),this.height=this.prop(24),this.port=e.port});r.prototype.render=function(){return i.render(r.HTML_TEXT)},r.prototype.onredraw=function(){this.redrawBy("cx","cy",function(t,e){i.translate(this.el,t-this.width()/2,e-this.height()/2)}),this.redrawBy("type",function(t){i.data(this.el,"type",t)}),this.redrawBy("visible",function(t){i.toggleClass(this.el,"hide",!t)}),this.redrawBy("highlighted",function(t){i.toggleClass(this.el,"highlighted",t)})},r.HTML_TEXT='<div class="wire-handle"></div>',void 0!==e&&e.exports?e.exports=r:n.WireHandle=r}(this.app||(this.app={}))},{"../dom.js":17,jcore:void 0}],16:[function(t,e,n){!function(n){"use strict";var o=t("jcore"),i=n.dom||t("../dom.js"),r=o.Component.inherits(function(t,e){this.sourceX=this.prop(e.sourceX),this.sourceY=this.prop(e.sourceY),this.targetX=this.prop(e.targetX),this.targetY=this.prop(e.targetY),this.highlighted=this.prop(e.highlighted)});r.prototype.pathElement=function(){return i.find(this.el,"path")},r.prototype.render=function(){return i.render(r.HTML_TEXT)},r.prototype.onredraw=function(){this.redrawBy("sourceX","sourceY","targetX","targetY",function(t,e,n,o){var r=Math.min(t,n),s=Math.min(e,o),h=["M",t-r,e-s,"L",n-r,o-s].join(" ");i.translate(this.el,r,s),i.attr(this.pathElement(),{d:h})}),this.redrawBy("highlighted",function(t){i.className(this.pathElement(),"wire-path"+(t?" highlighted":""))})},r.HTML_TEXT=['<svg class="wire">','<path class="wire-path"></path>',"</svg>"].join(""),void 0!==e&&e.exports?e.exports=r:n.Wire=r}(this.app||(this.app={}))},{"../dom.js":17,jcore:void 0}],17:[function(t,e,n){(function(t){!function(n){"use strict";var o={};o.export=function(e,n){var o=void 0!==t?t:window;Object.defineProperty(o,e,{value:n})},o.body=function(){return document.body},o.render=function(t){var e=document.createRange().createContextualFragment(t).firstChild;return e.parentNode.removeChild(e),e},o.find=function(t,e){return t.querySelector(e)},o.contains=function(t,e){return t.contains(e)},o.attr=function(t,e){Object.keys(e).forEach(function(n){t.setAttribute(n,e[n])})},o.css=function(t,e){var n=t.style;Object.keys(e).forEach(function(t){n[t]=e[t]})},o.className=function(t,e){o.attr(t,{class:e})},o.addClass=function(t,e){t.classList.add(e)},o.toggleClass=function(t,e,n){n?t.classList.add(e):t.classList.remove(e)},o.hasClass=function(t,e){return t.classList.contains(e)},o.data=function(t,e,n){t.dataset[e]=n},o.text=function(t,e){t.textContent=e},o.value=function(t,e){if(void 0===e)return t.value;t.value=e},o.hasSelection=function(t){return t.selectionStart!==t.selectionEnd},o.selectAll=function(t){t.setSelectionRange(0,t.value.length)},o.clearSelection=function(t){t.setSelectionRange(t.selectionStart,t.selectionStart)},o.offsetLeft=function(t){return t.getBoundingClientRect().left-t.scrollLeft-document.body.getBoundingClientRect().left},o.offsetTop=function(t){return t.getBoundingClientRect().top-t.scrollTop-document.body.getBoundingClientRect().top},o.file=function(t){return t.files[0]},o.contentWindow=function(t){return t.contentWindow},o.contentHeight=function(t){var e=t.contentDocument;return Math.max(e.documentElement.scrollHeight,e.body.scrollHeight)},o.isFocused=function(t){return t===document.activeElement},o.removeFocus=function(){document.activeElement.blur()},o.clone=function(t){return t.cloneNode(!0)},o.translate=function(t,e,n){t.style.transform="translate("+e+"px, "+n+"px)"},o.translateY=function(t,e){t.style.transform="translateY("+e+"px)"},o.on=function(t,e,n,o){t.addEventListener(e,n,!!o)},o.off=function(t,e,n,o){t.removeEventListener(e,n,!!o)},o.once=function(t,e,n,i){var r=function(){o.off(t,e,r,i),n.apply(null,arguments)};o.on(t,e,r,i)},o.ready=function(t){document.addEventListener("DOMContentLoaded",t,!1)},o.click=function(t){t.click()},o.supportsTouch=function(){return"ontouchstart"in window||"undefined"!=typeof DocumentTouch&&document instanceof DocumentTouch},o.changedTouch=function(t){return o.supportsTouch()&&"changedTouches"in t?t.changedTouches[0]:null},o.target=function(t){var e=o.changedTouch(t);return e?document.elementFromPoint(e.clientX,e.clientY):t.target},o.cancel=function(t){t.preventDefault()},o.stop=function(t){t.stopPropagation()},o.eventType=function(t){switch(t){case"start":return o.supportsTouch()?"touchstart":"mousedown";case"move":return o.supportsTouch()?"touchmove":"mousemove";case"end":return o.supportsTouch()?"touchend":"mouseup";default:throw new Error("Invalid event type")}},o.readFile=function(t){return new Promise(function(e,n){var o=new FileReader,i=function(){n(new Error("Failed to read file: "+t.name))};o.onload=function(t){e(t.target.result)},o.onerror=i,o.onabort=i,o.readAsText(t)})},o.ajax=function(t){var e=t.type,n=t.url;return new Promise(function(t,o){var i=new XMLHttpRequest,r=function(){o(new Error("Failed to load resource: "+e+" "+n))};i.onload=function(){i.status>=200&&i.status<400?t(i.response):r()},i.onerror=r,i.onabort=r,i.open(e,n,!0),i.send()})},o.loadJSON=function(t){return o.ajax({type:"GET",url:t}).then(function(t){return JSON.parse(t)})},o.location=function(){return document.location},o.urlQuery=function(t,e){for(var n=t.search.substring(1).split("&"),o=0,i=n.length;o<i;o++){var r=n[o].split("=");if(decodeURIComponent(r[0]||"")===e)return decodeURIComponent(r[1]||"")}return null},void 0!==e&&e.exports?e.exports=o:n.dom=o}(this.app||(this.app={}))}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],18:[function(t,e,n){!function(t){"use strict";var n={};n.clamp=function(t,e,n){return Math.min(Math.max(t,e),n)},n.extend=function(t,e){return Object.keys(e).forEach(function(n){t[n]=e[n]}),t},n.omit=function(t,e){return Object.keys(t).reduce(function(n,o){return-1===e.indexOf(o)&&(n[o]=t[o]),n},{})},n.sortBy=function(t,e){return t.sort(function(t,n){var o=e(t),i=e(n);return o<i?-1:o>i?1:0})},n.remove=function(t,e){var n=t.indexOf(e);-1!==n&&t.splice(n,1)},n.moveToBack=function(t,e){n.remove(t,e),t.push(e)},n.find=function(t,e){for(var n=0,o=t.length;n<o;n++)if(e(t[n],n,t))return t[n];return null},n.findLast=function(t,e){for(var n=t.length-1;n>=0;n--)if(e(t[n],n,t))return t[n];return null},n.flatten=function(t){return Array.prototype.concat.apply([],t)},n.wrapper=function(){var t=function(e,n){return Object.defineProperty(n,"unwrap",{value:t.unwrap.bind(e)})};return t.unwrap=function(e){return e===t.KEY?this:null},t.KEY={},t},void 0!==e&&e.exports?e.exports=n:t.helper=n}(this.app||(this.app={}))},{}],19:[function(t,e,n){!function(n){"use strict";var o=t("circuit"),i=n.helper||t("../helper.js"),r=i.wrapper(),s=function(t,e){return this.members=t,this.wrapper(e)};s.prototype.get=function(t){return i.findLast(this.members,function(e){return e.name===t})},s.prototype.getAll=function(){return this.members.slice()},s.prototype.wrapper=function(t){return{get:this.get.bind(this),getAll:this.getAll.bind(this),options:t}},s.bind=function(t,e){var n=t.unwrap(r.KEY).callee,i=e.unwrap(r.KEY).callee;o.bind(n,i)},s.unbind=function(t,e){var n=t.unwrap(r.KEY).callee,i=e.unwrap(r.KEY).callee;o.unbind(n,i)},s.Member=function(){var t=function(t){return this.callee=o[t.type](t.arg),this.wrapper(i.omit(t,["arg"]))};return t.prototype.call=function(){return this.callee.apply(null,arguments)},t.prototype.wrapper=function(t){var e=new r(this,this.call.bind(this));return Object.keys(t).reduce(function(e,n){return Object.defineProperty(e,n,{value:t[n],enumerable:!0})},e)},t}(),s.ModularModule=function(t,e){return new s(t.map(function(t){return new s.Member({label:t.label,name:t.name,type:"prop"!==t.type?t.type:"data",arg:Object.prototype.hasOwnProperty.call(t,"arg")?t.arg:void 0,plugDisabled:!!t.plugDisabled,socketDisabled:!!t.socketDisabled})}),e||{})},s.modular=function(){return Object.create(Object.prototype,{Module:{value:s.ModularModule},exports:{value:null,writable:!0}})},void 0!==e&&e.exports?e.exports=s:n.CircuitModule=s}(this.app||(this.app={}))},{"../helper.js":18,circuit:void 0}],20:[function(t,e,n){!function(n){"use strict";var o=n.helper||t("../helper.js"),i=n.Entry||t("./entry.js"),r=function(t){this.entries=[],this.jsonLoader=t.jsonLoader};r.prototype.packageNamesUrl=function(){return"modular_modules/index.json"},r.prototype.entriesUrl=function(t){return"modular_modules/"+encodeURI(t)+"/index.json"},r.prototype.get=function(t){return o.findLast(this.entries,function(e){return e.name===t})},r.prototype.search=function(t){return o.sortBy(this.entries.filter(function(e){return 0!==e.keywordScore(t)}),function(e){return-e.keywordScore(t)})},r.prototype.load=function(){return this.loadPackageNames().then(function(t){return Promise.all(t.map(function(t){return this.loadEntries(t)},this))}.bind(this)).then(function(t){this.entries=o.flatten(t)}.bind(this))},r.prototype.loadPackageNames=function(){return this.jsonLoader(this.packageNamesUrl())},r.prototype.loadEntries=function(t){return this.jsonLoader(this.entriesUrl(t)).then(function(e){return e.map(function(e){var n=t+"/"+e.src;return new i(o.extend(e,{name:n}))})})},void 0!==e&&e.exports?e.exports=r:n.EntryCollection=r}(this.app||(this.app={}))},{"../helper.js":18,"./entry.js":21}],21:[function(t,e,n){!function(t){"use strict";var n=function(t){this.name=t.name,this.label=t.label||"",this.description=t.description||"",this.src=t.src||"",this.visiblePortNames=t.visiblePortNames||[],this.tags=t.tags||[]};n.prototype.keywordScore=function(t){if(!t)return 0;t=t.toLowerCase();var e=this.label.toLowerCase().indexOf(t);if(0===e)return 1;for(var n=this.tags,o=0,i=n.length;o<i;o++){var r=n[o].toLowerCase();if(r===t||t.length>=2&&-1!==r.indexOf(t))return.75}if(t.length<2)return 0;if(-1!==e)return.5;return-1!==this.description.toLowerCase().indexOf(t)?.25:0},void 0!==e&&e.exports?e.exports=n:t.Entry=n}(this.app||(this.app={}))},{}],22:[function(t,e,n){!function(n){"use strict";var o=t("jcore").Relation.inherits(function(t){this.type=t.type,this.port=t.port,this.wire=t.wire,this.updater=o.UPDATERS[this.type]});o.prototype.update=function(){this.updater(this.port,this.wire)},o.UPDATERS=[function(t,e){e.sourceX(t.plugX()),e.sourceY(t.plugY())},function(t,e){e.targetX(t.socketX()),e.targetY(t.socketY())}],o.TYPE_PLUG=0,o.TYPE_SOCKET=1,void 0!==e&&e.exports?e.exports=o:n.LockRelation=o}(this.app||(this.app={}))},{jcore:void 0}]},{},[1]);