!function t(e,n,o){function r(a,s){if(!n[a]){if(!e[a]){var c="function"==typeof require&&require;if(!s&&c)return c(a,!0);if(i)return i(a,!0);var p=new Error("Cannot find module '"+a+"'");throw p.code="MODULE_NOT_FOUND",p}var d=n[a]={exports:{}};e[a][0].call(d.exports,function(t){var n=e[a][1][t];return r(n?n:t)},d,d.exports,t,e,n,o)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<o.length;a++)r(o[a]);return r}({1:[function(t,e,n){!function(e){"use strict";var n=t("mithril"),o=e.SidePanelComponent||t("./components/side-panel-component.js"),r=e.MainPanelComponent||t("./components/main-panel-component.js"),i=function(){var t=function(){},e=this.panelEvent={addPiece:t,ondragend:function(t){e.addPiece(t.pageX,t.pageY,t.pieceLabel,t.pieceSrc)}}},a=function(t){return[n.component(o,t.panelEvent),n.component(r,t.panelEvent)]};n.mount(document.getElementById("container"),{controller:i,view:a})}(this.app||(this.app={}))},{"./components/main-panel-component.js":4,"./components/side-panel-component.js":7,mithril:void 0}],2:[function(t,e,n){!function(n){"use strict";var o=t("mithril"),r=function(){this._dirtyIDs=[],this._positionMap={},this._connections=[]};r.prototype.append=function(t,e){var n=i(this,t,e);n||this._connections.push({sourceID:t,targetID:e})},r.prototype.remove=function(t,e){var n=i(this,t,e);if(n)for(var o=this._connections,r=o.length-1;r>=0;r--){var a=o[r];a.sourceID===t&&a.targetID===e&&o.splice(r,1)}},r.prototype.change=function(t,e){var n=t[0],o=t[1],r=e[0],a=e[1];if(n!==r||o!==a){var s=i(this,n,o);if(s){var c=i(this,r,a);c&&this.remove(r,a),s.sourceID=r,s.targetID=a;var p=s.element;p.setAttribute("data-source-id",r),p.setAttribute("data-target-id",a)}}},r.prototype.position=function(t,e){return"undefined"==typeof e?this._positionMap[t]||{x:0,y:0}:(this._dirtyIDs.push(t),void(this._positionMap[t]=e))},r.prototype.updatePosition=function(){var t=this._dirtyIDs,e=this._positionMap;t.forEach(function(t){var n=a(this,t,t);n.forEach(function(t){var n=e[t.sourceID],o=e[t.targetID];t.element&&t.element.setAttribute("d","M"+n.x+","+n.y+"L"+o.x+","+o.y+"Z")})}.bind(this)),this._dirtyIDs=[]},r.prototype.refreshPosition=function(){var t=this._positionMap;for(var e in t){var n=a(this,e,e);0===n.length&&delete t[e]}},r.prototype.getSourceID=function(t){var e=i(this,null,t);return e?e.sourceID:null},r.prototype.getTargetIDs=function(t){var e=a(this,t);return e.map(function(t){return t.targetID})},r.prototype.setFlushPath=function(t,e,n){var o=i(this,t,e);if(o){var r=o.element;n?r.setAttribute("class","flush"):r.removeAttribute("class")}},r.prototype.getConnectionList=function(){return this._connections.map(function(t){return{sourceID:t.sourceID,targetID:t.targetID}})},r.prototype.setPathElement=function(t,e,n){var o=i(this,e,n);o.element=t};var i=function(t,e,n){for(var o=t._connections,r=o.length-1;r>=0;r--){var i=o[r];if((!e||i.sourceID===e)&&i.targetID===n)return i}return null},a=function(t,e,n){return t._connections.filter(function(t){return t.sourceID===e||t.targetID===n})},s=function(t){this._element=t,this._pieceMap={},this._connectorSizeOffset=21,this._dirtyPortConnectorConnectedMap={}};s.prototype.element=function(t){this._element=t},s.prototype.append=function(t){var e=c();t.id(e),this._pieceMap[e]=t,o.redraw()},s.prototype.remove=function(t){t.destroy();var e=t.id();delete this._pieceMap[e],o.redraw()},s.prototype.pieceMap=function(){return this._pieceMap},s.prototype.pieces=function(){var t=this._pieceMap;return Object.keys(t).map(function(e){return t[e]})},s.prototype.startDrag=function(){dom.addClass(this._element,"drag")},s.prototype.endDrag=function(){dom.removeClass(this._element,"drag")},s.prototype.getInConnectorNotConnectedElements=function(t){for(var e=this._element.querySelectorAll(".port-connector-in"),n=[],o=0,r=e.length;r>o;o++){var i=e[o],a=i.parentNode.parentNode;dom.hasClass(a,t)&&!dom.hasClass(a,"hide-connector-in")&&dom.hasClass(a,"hide-connector-connected")&&n.push(i)}return n},s.prototype.getPort=function(t){var e=t.split("/"),n=e[0],o=this._pieceMap[n],r=o.portMap();return r[e[1]+"/"+e[2]]},s.prototype.showPortConnectorConnected=function(t){this._dirtyPortConnectorConnectedMap[t]=!0},s.prototype.hidePortConnectorConnected=function(t){this._dirtyPortConnectorConnectedMap[t]=!1},s.prototype.updatePortConnectorConnected=function(){var t=this._dirtyPortConnectorConnectedMap,e=Object.keys(t).map(function(e){var n=this.getPort(e);t[e]?n.showConnectorConnected():n.hideConnectorConnected()}.bind(this));0!==e.length&&(this._dirtyPortConnectorConnectedMap={})},s.prototype.getOutConnectorElement=function(t){var e=this.getPort(t);return e.getOutConnectorElement()},s.prototype.getConnectorOffset=function(t){var e=0,n=0;if(t){var o=getComputedStyle(t,null),r=t.getBoundingClientRect(),i=this._element.parentNode,a=i.getBoundingClientRect();e=r.left+i.scrollLeft-a.left-parseInt(o.marginLeft||0)+parseInt(p()?0:o.borderLeftWidth||0),n=r.top+i.scrollTop-a.top-parseInt(o.marginTop||0)+parseInt(p()?0:o.borderTopWidth||0)}return{x:e,y:n}},s.prototype.getConnectorPosition=function(t,e){var n,o=t.split("/"),r=o[0],i=o[1]+"/"+o[2],a=o[3],s=this._pieceMap[r],c=s.portMap(),d=c[i],u=this._connectorSizeOffset;return"out"===a?(n=e?this.getConnectorOffset(d.getOutConnectorElement()):s.getOutConnectorOffset(d),{x:n.x+u,y:n.y+u}):"in"===a?(e?(n=this.getConnectorOffset(d.getInConnectorElement()),n.x-=p()?0:4,n.y-=p()?0:4):n=s.getInConnectorOffset(d),{x:n.x+u,y:n.y+u}):null},s.prototype.getConnectorSizeOffset=function(){return this._connectorSizeOffset},s.prototype.isLoading=function(){return 0!==this._element.querySelectorAll(".piece.loading").length};var c=function(){var t=Math.floor(Math.random()*Math.pow(10,16)),e=0;return function(){var n=CryptoJS.SHA1(("0"+t+e).slice(-16)+Math.random().toString().substring(1));return e+=1,n.toString()}}(),p=function(){return-1!==navigator.userAgent.toLowerCase().indexOf("firefox")},d=function(){this.type=o.prop(""),this.x=u(0),this.y=u(0),this.visible=u(!1),this.element=o.prop(null)};d.prototype.redraw=function(){var t=this.element();(this.x.dirty||this.y.dirty)&&(dom.translate(t,this.x(),this.y()),this.x.dirty=!1,this.y.dirty=!1),this.visible.dirty&&(this.visible()?dom.removeClass(t,"hide"):dom.addClass(t,"hide"),this.visible.dirty=!1)};var u=function(t){var e=t,n=function(t){return"undefined"==typeof t?e:void(e!==t&&(e=t,n.dirty=!0))};return n.dirty=!1,n},l=function(){this.boardEvent=n.boardEvent||t("./board-event.js"),this.pathContainer=new r,this.board=new s,this.connectorHandle=new d},h=function(t){var e=t.pathContainer,n=t.connectorHandle;return o("div",[o("svg#path_container",{config:function(n,o){o||t.boardEvent.setPathContainer(e)}},e.getConnectionList().map(function(t){var n=t.sourceID,r=t.targetID,i=e.position(n),a=e.position(r);return o("path",{key:n+"-"+r,d:"M"+i.x+","+i.y+"L"+a.x+","+a.y+"Z","data-source-id":n,"data-target-id":r,config:function(t,o){o||e.setPathElement(t,n,r)}})})),o("#board",{config:function(e,n){n||(t.board.element(e),t.boardEvent.setBoard(t.board))}},t.board.pieces().map(function(e){var n=e.ports(),r=n.concat().filter(function(t){return!t.isShowing()&&"prop"===t.type()}).sort(function(t,e){return t.contentText()>e.contentText()?1:-1}).map(function(t){return o("option",{value:t.id()},t.contentText())}),i=n.concat().filter(function(t){return!t.isShowing()&&"event"===t.type()}).sort(function(t,e){return t.contentText()>e.contentText()?1:-1}).map(function(t){return o("option",{value:t.id()},t.contentText())});return o(".piece",{key:e.id(),className:e.isLoading()?"loading":"","data-piece-id":e.id(),config:function(t,n){n||e.initializeElement(t)}},[o(".piece-header",[o(".piece-header-title",e.label()),o(".piece-header-delete-button",{className:dom.supportsTouch()?"":"hoverable"},"×")]),o(".piece-content",[o("iframe.piece-component",{src:e.src()+"#"+e.id(),style:{height:e.componentHeight()}}),o(".piece-port-list",{className:0===parseInt(e.componentHeight())?"no-component":""},n.map(function(t){return t.isShowing()?o(".port.hide-connector-connected",{key:t.id(),"data-port-id":t.id(),config:function(e,n){n||t.initializeElement(e)}},[o(".port-connector",[o(".port-connector-in"),o(".port-connector-connected"),o(".port-connector-out")]),o(".port-content",[o(".port-content-text",t.contentText()),o(".port-content-delete-button",{className:dom.supportsTouch()?"":"hoverable"},"×")])]):void 0}))]),o(".piece-footer",[o("select.piece-port-select",{className:0===r.length&&0===i.length?"hide":"",onchange:function(e){var n=e.currentTarget;t.boardEvent.showPort(e),n.value="",n.blur()}},[o("option",{value:""}),o("optgroup.piece-port-select-optgroup-prop",{label:"Property"},r),o("optgroup.piece-port-select-optgroup-event",{label:"Event"},i)])])])})),o(".port-connector-out.drag",{className:n.type()+" "+(n.visible()?"":"hide"),config:function(e,o){o||(n.element(e),t.boardEvent.setConnectorHandle(n))}})])},f={controller:l,view:h};"undefined"!=typeof e&&e.exports?e.exports=f:n.BoardComponent=f}(this.app||(this.app={}))},{"./board-event.js":3,mithril:void 0}],3:[function(t,e,n){!function(n){"use strict";function o(t,e){var n,o,r,i=[];if(t)for(n in t)o=t[n],r=new _({type:"prop",key:n,contentText:o.label,hasIn:o["in"]===!0,hasOut:o.out===!0,isDefault:o["default"]===!0}),i.push(r);if(e)for(n in e)o=e[n],r=new _({type:"event",key:n,contentText:o.label,hasIn:o["in"]===!0,hasOut:o.out===!0,isDefault:o["default"]===!0}),i.push(r);return i}function r(t){if("option"===t.tagName.toLowerCase())return null;for(;t;)if(t=t.parentNode,t&&"piece"===t.className){var e=k.pieceMap();return e[t.getAttribute("data-piece-id")]}return null}function i(t){var e=t.type;if("connect"===e||"disconnect"===e){var n=t.targetPortID.split("/"),o=n[0],r=n[1];if("event"===r)return;var i,s,c=n[2];if("connect"===e){var p=t.sourcePortID.split("/");i=z.get(p[0],p[2]),s=!0}else"disconnect"===e&&(i=null,s=!1);a(o,r,c,i,s)}}function a(t,e,n,o,r){var i={type:e,target:n};"prop"===e&&(i.data=o),i.isConnected=r;var a=k.pieceMap()[t];if(a){var s=a.getComponentElement();s.contentWindow.postMessage(JSON.stringify(i),"*")}}function s(t,e){var n=w(t),o=w(e),r=t+"/out",i=e+"/in";n.setFlushOutConnector(!0),o.setFlushInConnector(!0),o.setFlushConnectorConnected(!0),F.setFlushPath(r,i,!0),setTimeout(function(){n.setFlushOutConnector(!1),o.setFlushInConnector(!1),o.setFlushConnectorConnected(!1),F.setFlushPath(r,i,!1)},160)}function c(t){window.console&&"function"==typeof console.warn&&console.warn(t)}function p(t){var e=new M({x:t.x,y:t.y,src:t.src});return k.append(e),e.id()}function d(t,e){if("drag"!==t.target){var n=t.source.split("/"),o=e[n[0]]+"/"+n[1]+"/"+n[2],r=t.target.split("/"),i=e[r[0]]+"/"+r[1]+"/"+r[2];P(o,i)}}function u(){N=!0;var t=location.hash.substring(1);if(t){try{var e=JSON.parse(O.decode(t))}catch(n){return window.console&&"function"==typeof console.error&&console.error(n),void(N=!1)}for(var o=e.node,r={},i=0,s=o.length;s>i;i+=1){var u=o[i],l=p(u);r[u.id]=l}var h=0;setTimeout(function f(){if(L.redraw(!0),k.isLoading())100>h?(setTimeout(f,100),h+=1):(location.replace("#"+t),c("Load time out"),N=!1);else{for(var n=e.data,o=0,i=n.length;i>o;o+=1){var s=n[o],p=r[s.id];a(p,"prop",s.target,s.data,!1)}for(var u=e.link,o=0,i=u.length;i>o;o+=1){var l=u[o];d(l,r)}N=!1}},100)}else location.replace("#"),N=!1}function l(){window.addEventListener("message",function(t){try{var e=JSON.parse(t.data)}catch(n){return}var r=e.id,i=k.pieceMap()[r];if("undefined"!=typeof i){var c=e.data,p=e.type,d=e.target;switch(p){case"load":if(!i.isLoading())return;i.label(c.label),i.componentHeight(c.componentHeight);var u=o(c.prop,c.event);i.setPorts(u),i.vitalize();var l=c.prop;for(var d in l)"data"in l[d]&&z.set(r,d,l[d].data),l[d].serialize===!0&&z.setSerializeTarget(r,d);L.redraw();break;case"prop":z.set(r,d,c);for(var h=F.getTargetIDs(r+"/prop/"+d+"/out"),f=0,v=h.length;v>f;f+=1){var m=h[f];if("drag"!==m){var g=m.split("/"),r=g[0],d=g[2];a(r,"prop",d,c,!0)}}break;case"event":for(var y=r+"/event/"+d,h=F.getTargetIDs(y+"/out"),f=0,v=h.length;v>f;f+=1){var m=h[f];if("drag"!==m){var g=m.split("/"),r=g[0],d=g[2];a(r,"event",d,null,!0);var C=m.replace(/\/in$/,"");s(y,C)}}}j()}},!1)}function h(t){t.addEventListener(dom.supportsTouch()?"touchstart":"mousedown",function(t){var e=t.target;if(!dom.hasClass(e,"loading")){var n=t.target.className.toString().split(" ")[0],o=r(e);if(o){o.toFront(),o.updatePosition();var i=e.tagName.toLowerCase();"select"!==i&&dom.removeKeyboardFocus()}switch(n){case"piece-header-title":T(t);break;case"port-content-text":S(t);break;case"port-connector-out":q(t);break;case"port-connector-connected":q(t,!0)}}},!1)}function f(){dom.pointerEvent(".port-content-delete-button",{onstart:function(t){t.preventDefault()},ontap:function(t){var e=t.target.parentNode.parentNode.getAttribute("data-port-id"),n=e.split("/"),o=n[0],r=k.pieceMap()[o],i=r.portMap(),a=n[1]+"/"+n[2];r.hidePort(i[a]),D(e),E(o),F.updatePosition(),F.refreshPosition()}})}function v(){var t,e;dom.pointerEvent(".piece-header-delete-button",{onstart:function(n){n.preventDefault(),t=n.target.parentNode.parentNode.getAttribute("data-piece-id"),e=k.pieceMap()[t],dom.supportsTouch()&&dom.addClass(e.element(),"delete")},ontap:function(){k.remove(e),z.remove(t),j()},onout:function(){dom.supportsTouch()&&dom.removeClass(e.element(),"delete")},onover:function(){dom.supportsTouch()&&dom.addClass(e.element(),"delete")}})}function m(t){l(),h(t),f(),v()}function g(t){A=t}function y(t){k=t}function C(t){F=t}function b(t,e,n,o){var r=new M({x:t,y:e,label:n,src:o});k.append(r)}function x(t){var e=t.target.value.split("/"),n=e[0],o=k.pieceMap()[n],r=o.portMap(),i=e[1]+"/"+e[2];o.showPort(r[i])}function w(t){var e=t.split("/"),n=e[0],o=k.pieceMap()[n],r=o.portMap(),i=e[1]+"/"+e[2];return r[i]}function P(t,e){if(null!==t&&null!==e){var n=k.pieceMap(),o=t.split("/")[0],r=e.split("/")[0],a=n[o],s=n[r],c=w(t),p=w(e);a.showPort(c),s.showPort(p),p.element()||L.redraw(!0),p.showConnectorConnected(),F.append(t+"/out",e+"/in"),E(o),E(r),F.updatePosition(),i({type:"connect",sourcePortID:t,targetPortID:e}),L.redraw()}}function I(t,e){if(null!==t&&null!==e){var n=w(e);n.hideConnectorConnected(),F.remove(t,e),i({type:"disconnect",sourcePortID:t.replace(/\/out$/,""),targetPortID:e.replace(/\/in$/,"")})}}function D(t){for(var e=t+"/out",n=F.getTargetIDs(e),o=0,r=n.length;r>o;o+=1)I(e,n[o]);var i=t+"/in";I(F.getSourceID(i),i),L.redraw(!0)}function E(t,e){F.getConnectionList().forEach(function(n){var o=n.sourceID,r=n.targetID,i=o.split("/")[0],a=r.split("/")[0];i===t&&F.position(o,k.getConnectorPosition(o,e)),a===t&&F.position(r,k.getConnectorPosition(r,e))})}function T(t){function e(){s&&(dom.requestAnimationFrame(e),o.updatePosition(),F.updatePosition())}var n=t.target.parentNode.parentNode.getAttribute("data-piece-id"),o=k.pieceMap()[n],r=o.position(),i=r.x,a=r.y,s=!0;dom.startDragEvent(t,{drag:function(t,e){o.position({x:i+t,y:a+e}),E(n)},end:function(t,e){k.endDrag(),s=!1,dom.requestAnimationFrame(function(){o.position({x:i+t,y:a+e}),o.updatePosition(),E(n),F.updatePosition(),F.refreshPosition()}),dom.supportsTouch()&&dom.removeClass(o.element(),"drag"),j(),L.redraw()}}),k.startDrag(),dom.requestAnimationFrame(e),dom.supportsTouch()&&dom.addClass(o.element(),"drag")}function S(t){function e(){h&&(dom.requestAnimationFrame(e),i.style.top=n+"px",F.updatePosition())}var n,o,r,i=t.target.parentNode.parentNode,a=i.parentNode,s=i.getAttribute("data-port-id"),c=i.cloneNode(),p=dom.indexOf(a,i),d=46,u=d*p,l=d*(a.children.length-1),h=!0,f=s.split("/")[0],v=k.pieceMap()[f];dom.startDragEvent(t,{drag:function(t,e){var i=u+e;0>i&&(i=0),i>l&&(i=l),n=i;var s=parseInt((n-u)/d+(e>0?.5:-.5)),h=p+s+(s>=0?1:0);r!==h&&(a.insertBefore(c,o[h]||null),r=h),E(f,!0)},end:function(t,e){k.endDrag(),h=!1,dom.requestAnimationFrame(function(){i.style.cssText="",a.insertBefore(i,c),dom.removeClass(i,"drag"),a.removeChild(c),E(f,!0),F.updatePosition(),F.refreshPosition(),v.updatePortListOrder()})}}),k.startDrag(),dom.addClass(c,"placeholder"),dom.addClass(i,"drag"),a.insertBefore(c,i.nextSibling),o=a.querySelectorAll(".port:not(.drag)"),dom.requestAnimationFrame(e)}var O=t("js-base64").Base64,L=t("mithril"),M=n.Piece||t("./piece.js"),_=n.Port||t("./port.js"),N=!1,A=null,k=null,F=null,z=function(){function t(t,e,n){t in i||(i[t]={}),i[t][e]=n}function e(t,e){return t in i&&e in i[t]?i[t][e]:null}function n(t){delete i[t],delete a[t]}function o(t,e){t in a||(a[t]=[]),a[t].push(e)}function r(){var t=[];for(var e in a)for(var n=a[e],o=0,r=n.length;r>o;o+=1)t.push({pieceID:e,target:n[o],data:i[e][n[o]]});return t}var i={},a={};return{set:t,get:e,remove:n,setSerializeTarget:o,serialize:r}}(),j=function(){function t(t,e){var n=t.sourceID.split("/"),o=t.targetID.split("/");return{source:e[n[0]]+"/"+n[1]+"/"+n[2],target:e[o[0]]+"/"+o[1]+"/"+o[2]}}return lib.util.debounce(function(){if(!N){var e=k.pieceMap(),n={},o=0,r=[];for(var i in e){var a=e[i].getAttribute();a.id=o,n[i]=o,r[o]=a,o+=1}for(var s=F.getConnectionList(),p=0,d=s.length;d>p;p+=1)s[p]=t(s[p],n);for(var u=z.serialize(),p=0,d=u.length;d>p;p+=1){var i=u[p].pieceID;u[p].id=n[i],delete u[p].pieceID}var l="";r.length>0&&(l=O.encodeURI(JSON.stringify({node:r,link:s,data:u}))),location.replace("#"+l);var h=location.href.length;h>2083&&c("Too long URL("+h+" words)")}},100)}(),q=function(){function t(t){for(var e=k.getInConnectorNotConnectedElements(t),n=k.getConnectorSizeOffset(),o={},i=0,a=e.length;a>i;i+=1){var s=e[i],c=s.parentNode.parentNode.getAttribute("data-port-id"),p=k.getConnectorOffset(e[i]);p.x+=n-(r?0:4),p.y+=n-(r?0:4),o[c]=p}return o}function e(t){var e={};for(var n in t){var o=t[n],r=o.x,i=o.y;r in e||(e[r]={}),e[r][i]=n}return e}function n(t,e){var n=k.getConnectorSizeOffset(),o=e.x,r=e.y;for(var i in t)if(Math.abs(o-i)<n){var a=t[i];for(var s in a)if(Math.abs(r-s)<n)return{portID:a[s],point:{x:i,y:s}}}return null}function o(t){return dom.hasClass(t,"prop")?"prop":dom.hasClass(t,"event")?"event":void 0}var r=-1!==navigator.userAgent.toLowerCase().indexOf("firefox");return function(r,a){function s(){E&&(dom.requestAnimationFrame(s),A.redraw(),F.updatePosition(),k.updatePortConnectorConnected())}function c(){A.x(v.x),A.y(v.y),dom.hasClass(m,"prop")?A.type("prop"):dom.hasClass(m,"event")&&A.type("event"),A.redraw(),L.redraw()}var p,d=k.getConnectorSizeOffset(),u=r.target;if(a){var l=u.parentNode.parentNode.getAttribute("data-port-id"),h=F.getSourceID(l+"/in"),f=k.getOutConnectorElement(h.replace(/\/out/,""));p=f}else p=u;if(!dom.hasClass(p,"drag")){var v=k.getConnectorOffset(p),m=p.parentNode.parentNode,l=m.getAttribute("data-port-id"),g={x:v.x+d,y:v.y+d},y=k.getConnectorOffset(u),C={x:y.x+d,y:y.y+d},b=t(o(m));if(a){var x=u.parentNode.parentNode.getAttribute("data-port-id");b[x]=C}var P,I,D=e(b),E=!0;dom.startDragEvent(r,{drag:function(t,e){A.x(y.x+t),A.y(y.y+e);var o={x:C.x+t,y:C.y+e},r=n(D,o),a=I.replace(/\/in$/,"");if(null!==r){var s=r.portID+"/in";if(s!==I){var c=I;if(F.change([P,I],[P,s]),I=s,F.position(s,r.point),A.visible(!1),k.showPortConnectorConnected(r.portID),"drag"!==a){k.hidePortConnectorConnected(a);var p=c.replace(/\/in$/,"");i({type:"disconnect",sourcePortID:P.replace(/\/out$/,""),targetPortID:p}),dom.supportsTouch()&&w(p).clearMark()}var d=I.replace(/\/in$/,"");i({type:"connect",sourcePortID:P.replace(/\/out$/,""),targetPortID:d}),dom.supportsTouch()&&w(d).mark()}}else{var s="drag";if(s!==I){var c=I;F.change([P,I],[P,s]),I=s,"drag"!==a&&k.hidePortConnectorConnected(a),A.visible(!0);var p=c.replace(/\/in$/,"");i({type:"disconnect",sourcePortID:P.replace(/\/out$/,""),targetPortID:p}),dom.supportsTouch()&&w(p).clearMark()}F.position(s,o)}},end:function(t,e){if(k.endDrag(),E=!1,dom.requestAnimationFrame(function(){A.visible(!1),A.x(2*-d),A.y(2*-d),A.redraw(),F.remove(P,"drag"),F.refreshPosition(),dom.setCursor("default"),L.redraw()}),dom.supportsTouch()&&(w(l).clearMark(),"drag"!==I)){var n=I.replace(/\/in$/,"");w(n).clearMark()}j()}}),k.startDrag(),c(),P=l+"/out",a?(I=x+"/in",A.visible(!1)):(I="drag",A.visible(!0)),F.append(P,I),F.position(P,g),F.position(I,C),F.updatePosition(),L.redraw(),dom.supportsTouch()&&dom.requestAnimationFrame(function(){w(l).mark(),a&&w(x).mark()}),dom.setCursor("crosshair"),dom.requestAnimationFrame(s)}}}(),H={initialize:m,setConnectorHandle:g,setBoard:y,setPathContainer:C,addPiece:b,showPort:x,removePortConnection:D,loadURLHash:u};"undefined"!=typeof e&&e.exports?e.exports=H:n.boardEvent=H}(this.app||(this.app={}))},{"./piece.js":5,"./port.js":6,"js-base64":void 0,mithril:void 0}],4:[function(t,e,n){!function(n){"use strict";var o=t("mithril"),r=n.BoardComponent||t("./board-component.js"),i=n.boardEvent||t("./board-event.js"),a=function(t){return this instanceof a?(this.element=o.prop(null),void(t.addPiece=this.addPiece.bind(this))):new a(t)};a.prototype.addPiece=function(t,e,n,o){var r=this.element();if(r){var a=t-r.offsetLeft+r.scrollLeft,s=e+r.scrollTop;0>a||0>s||i.addPiece(a,s,n,o)}},a.prototype.dispatchEvent=function(t){switch(t.type){case"init":this.element(t.element)}};var s=function(t){return o("#main_panel",{config:c.bind(t)},[o.component(r),o(".retainer",{config:p.bind(t)})])},c=function(t,e){if(!e){var n=this;n.dispatchEvent({type:"init",element:t}),i.initialize(t),i.loadURLHash()}},p=function(t,e){if(e){var n=this,o=n.element(),r=o.scrollLeft,i=o.scrollTop;dom.addClass(t,"hide");var a=o.clientWidth,s=o.clientHeight,c=o.scrollWidth,p=o.scrollHeight;if(c>a||p>s){var d=c+(c>a?46:-1),u=p+(p>s?46:-1);dom.translate(t,d,u),dom.removeClass(t,"hide"),o.scrollLeft=r,o.scrollTop=i}}},d={controller:a,view:s};"undefined"!=typeof e&&e.exports?e.exports=d:n.MainPanelComponent=d}(this.app||(this.app={}))},{"./board-component.js":2,"./board-event.js":3,mithril:void 0}],5:[function(t,e,n){!function(n){"use strict";var o=t("mithril"),r=function(t){this.id=o.prop(""),this.x=o.prop(t.x||0),this.y=o.prop(t.y||0),this.label=o.prop(t.label||""),this.src=o.prop(t.src),this.portMap=o.prop({}),this.ports=o.prop([]),this.isLoading=o.prop(!0),this.element=o.prop(null),this.componentHeight=i(0),this.zIndex=o.prop(a),this.isShowingInConnector=o.prop(!1),a++};r.prototype.initializeElement=function(t){this.element(t),this.updatePosition()},r.prototype.destroy=function(){var e=n.boardEvent||t("./board-event.js"),o=this.id(),r=this.portMap();for(var i in r)e.removePortConnection(o+"/"+i)},r.prototype.vitalize=function(){this.updatePosition(),this.isLoading(!1)},r.prototype.position=function(t){if("undefined"==typeof t)return{x:this.x(),y:this.y()};if("x"in t){var e=Math.max(t.x,this.isShowingInConnector()?46:0);this.x(e)}if("y"in t){var n=Math.max(t.y,0);this.y(n)}},r.prototype.updatePosition=function(){var t=this.element();if(t){var e=Math.max(this.x(),this.isShowingInConnector()?46:0);this.x(e),dom.translate(t,this.x(),this.y()),t.style.zIndex=this.zIndex()}},r.prototype.updateIsShowingInConnector=function(){var t=this.ports().some(function(t){return t.isShowing()&&t.hasIn()});this.isShowingInConnector(t)},r.prototype.updatePortListOrder=function(){var t=this.portMap(),e=this.ports(),n=this.element().children[1].children[1].children,o=Array.prototype.slice.call(n).map(function(e){var n=e.getAttribute("data-port-id").split("/");return t[n[1]+"/"+n[2]]}).filter(function(t){return t.isShowing()}),r=e.filter(function(t){return-1===o.indexOf(t)}).sort(function(t,e){return t.isShowing()&&!e.isShowing()?-1:!t.isShowing()&&e.isShowing()?1:0});this.ports(o.concat(r))},r.prototype.getInConnectorOffset=function(t){var e=this.ports().indexOf(t),n=parseInt(this.componentHeight());return{x:this.x()-46,y:this.y()+34+(n||-2)+46*e+4}},r.prototype.getOutConnectorOffset=function(t){var e=this.ports().indexOf(t),n=parseInt(this.componentHeight());return{x:this.x()+240,y:this.y()+34+(n||-2)+46*e+4}},r.prototype.setPorts=function(t){for(var e=this.id(),n={},o=[],r=0,i=t.length;i>r;r++){var a=t[r],s=a.name();a.pieceID(e),a.isDefault()?this.showPort(a):this.hidePort(a),n[s]=a,o.push(a)}this.portMap(n),this.ports(o),this.updateIsShowingInConnector()},r.prototype.showPort=function(t){if(!t.isShowing()){for(var e=this.ports(),n=e.length-1;n>=0;n--)e[n]===t&&e.splice(n,1);e.push(t),t.show(),this.updatePortListOrder(),this.updateIsShowingInConnector(),this.updatePosition(),o.redraw(!0);var r=this.element(),i=t.element();r&&i&&r.children[1].children[1].appendChild(i)}},r.prototype.hidePort=function(t){t.hide(),this.updatePortListOrder(),this.updateIsShowingInConnector(),this.updatePosition(),o.redraw()},r.prototype.toFront=function(){a++,this.zIndex(a)},r.prototype.getAttribute=function(){return{id:this.id(),src:this.src(),x:this.x(),y:this.y()}},r.prototype.getComponentElement=function(){return this.element().children[1].children[0]};var i=function(t){var e=o.prop(t);return function(t){if("undefined"==typeof t)return e();e(t);var n=this.element();0===parseInt(t)&&n&&dom.addClass(n.children[1].children[0],"hide")}},a=1;"undefined"!=typeof e&&e.exports?e.exports=r:n.Piece=r}(this.app||(this.app={}))},{"./board-event.js":3,mithril:void 0}],6:[function(t,e,n){!function(n){"use strict";var o=t("mithril"),r=function(t){this.type=o.prop(t.type),this.key=o.prop(t.key),this.contentText=o.prop(t.contentText),this.hasIn=o.prop(t.hasIn),this.hasOut=o.prop(t.hasOut),this.isDefault=o.prop(t.isDefault),this.isShowing=o.prop(t.isDefault),this.pieceID=o.prop(""),this.element=o.prop(null)};r.prototype.id=function(){return this.pieceID()+"/"+this.type()+"/"+this.key()},r.prototype.name=function(){return this.type()+"/"+this.key()},r.prototype.initializeElement=function(t){this.element(t),dom.addClass(t,this.type()),this.hasIn()||dom.addClass(t,"hide-connector-in"),this.hasOut()||dom.addClass(t,"hide-connector-out")},r.prototype.show=function(){this.isShowing(!0)},r.prototype.hide=function(){this.isShowing(!1)},r.prototype.showConnectorConnected=function(){dom.removeClass(this.element(),"hide-connector-connected")},r.prototype.hideConnectorConnected=function(){dom.addClass(this.element(),"hide-connector-connected")},r.prototype.getOutConnectorElement=function(){var t=this.element();return t?t.children[0].children[2]:null},r.prototype.getInConnectorElement=function(){var t=this.element();return t?t.children[0].children[0]:null},r.prototype.setFlushInConnector=function(t){var e=this.element();t?dom.addClass(e,"flush-connector-in"):dom.removeClass(e,"flush-connector-in")},r.prototype.setFlushConnectorConnected=function(t){var e=this.element();t?dom.addClass(e,"flush-connector-connected"):dom.removeClass(e,"flush-connector-connected")},r.prototype.setFlushOutConnector=function(t){var e=this.element();t?dom.addClass(e,"flush-connector-out"):dom.removeClass(e,"flush-connector-out")},r.prototype.mark=function(){dom.addClass(this.element(),"mark")},r.prototype.clearMark=function(){dom.removeClass(this.element(),"mark")},"undefined"!=typeof e&&e.exports?e.exports=r:n.Port=r}(this.app||(this.app={}))},{mithril:void 0}],7:[function(t,e,n){!function(n){"use strict";var o=t("mithril"),r=function(t){return this instanceof r?(this.state=o.prop(r.STATE_OPEN),this.pieceList=o.prop([]),this.searchKeyword=o.prop(""),this.ondragend=t.ondragend,void this.loadPieceList("piecelist/default.json")):new r(t)};r.prototype.loadPieceList=function(t){o.request({method:"GET",url:t}).then(this.pieceList)},r.prototype.searchPieceList=function(t){if(!t)return[];var e=this.pieceList(),n=[],o=[],r=[],a=[];return t=t.toLowerCase(),e.forEach(function(e){var s=e.label.toLowerCase(),c=e.description.toLowerCase();0===s.indexOf(t)?n.push(e):i(e.tag,t)?o.push(e):t.length>=2&&-1!==s.indexOf(t)?r.push(e):t.length>=2&&-1!==c.indexOf(t)&&a.push(e)}),n.concat(o,r,a)},r.prototype.dispatchEvent=function(t){var e=this.state();switch(t.type){case"toggle":e===r.STATE_OPEN?this.state(r.STATE_CLOSE):e===r.STATE_CLOSE&&this.state(r.STATE_OPEN),o.redraw();break;case"open":this.state(r.STATE_OPEN),o.redraw();break;case"close":this.state(r.STATE_CLOSE),o.redraw();break;case"searchkeywordchange":this.searchKeyword(t.value),o.redraw();break;case"dragend":this.ondragend(t)}};var i=function(t,e){return t.some(function(t){return-1!==t.toLowerCase().indexOf(e)})};r.STATE_OPEN="open",r.STATE_CLOSE="close";var a=function(t){var e=t.state(),n=t.searchKeyword(),r=t.searchPieceList(n);return o("#side_panel",{className:e},[o("input#search_input",{type:"search",autocapitalize:"off",autocorrect:"off",value:n,config:s.bind(t)}),o("#piece_list",{config:c.bind(t)},[o("#piece_list_content",r.map(function(t){return o(".piece-list-item",[o(".piece-list-item-container",{className:dom.supportsTouch()?"":"hoverable","data-piece-src":t.src},[o(".piece-list-item-header",t.label),o(".piece-list-item-content",t.description)])])}))]),o("#divider",[o("#divider_icon",{config:p.bind(t)})])])},s=function(t,e){if(!e){var n=this,o=!1;dom.supportsTouch()?document.addEventListener("touchstart",function(e){e.target!==t&&t.blur()}):(t.addEventListener("blur",function(){o=!1}),t.addEventListener("click",function(){o||(o=!0,t.selectionStart===t.selectionEnd&&t.select())}));var r=function(t){var e=n.searchKeyword(),o=t.target.value;o!==e&&n.dispatchEvent({type:"searchkeywordchange",value:o})};t.addEventListener("change",r),t.addEventListener("input",r)}},c=function(t,e){if(!e){var n,o,r,i,a,s,c=this,p=function(){var e=t.children[0];r={left:o.offsetLeft-e.scrollLeft,top:o.offsetTop-e.scrollTop},i=!0,a=!1,o.style.opacity=.6,dom.removeKeyboardFocus(),s=o.cloneNode(!0),dom.addClass(s,"drag"),document.body.appendChild(s)};dom.pointerEvent(".piece-list-item-container",{onstart:function(t){n=!dom.supportsTouch(),o=t.target,dom.supportsTouch()||p()},onhold:function(){n=!0,dom.supportsTouch()&&p()},ondrag:function(t,e,o){n&&(t.preventDefault(),t.stopPropagation(),i&&(i=!1,window.innerWidth<358&&(a=!0,c.dispatchEvent({type:"close"})),s.style.left=r.left+"px",s.style.top=r.top+"px"),dom.translate(s,e,o))},ondragend:function(t,e,o){if(n){var i=r.left+e,a=r.top+o,p={type:"dragend",pageX:i,pageY:a,pieceSrc:s.getAttribute("data-piece-src"),pieceLabel:s.children[0].textContent};c.dispatchEvent(p)}},onend:function(){n&&(o.style.cssText="",document.body.removeChild(s),a&&c.dispatchEvent({type:"open"}))}})}},p=function(t,e){if(!e){var n=this;dom.pointerEvent("#divider_icon",{ontap:function(){n.dispatchEvent({type:"toggle"}),dom.setCursor("default"),dom.removeClass(t,"tap")},onstart:function(e){e.preventDefault(),dom.addClass(t,"tap"),dom.removeKeyboardFocus(),dom.setCursor("pointer")},onout:function(){dom.removeClass(t,"tap"),dom.setCursor("default")},onover:function(){dom.addClass(t,"tap"),dom.setCursor("pointer")}})}},d={controller:r,view:a};"undefined"!=typeof e&&e.exports?e.exports=d:n.SidePanelComponent=d}(this.app||(this.app={}))},{mithril:void 0}]},{},[1]);